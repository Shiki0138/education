<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>デバッグテスト - 合格への道</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .warning { background: #fff3cd; color: #856404; }
        button { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; }
        .test-btn { background: #007bff; color: white; }
        .test-btn:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>🔧 アプリ動作デバッグテスト</h1>
    
    <div id="testResults"></div>
    
    <h2>📊 手動テスト</h2>
    <button class="test-btn" onclick="testKanjiButton()">漢字練習ボタンテスト</button>
    <button class="test-btn" onclick="testReadingButton()">読解問題ボタンテスト</button>
    <button class="test-btn" onclick="testVocabularyButton()">語彙力ボタンテスト</button>
    <button class="test-btn" onclick="testAIButton()">AI問題生成ボタンテスト</button>
    
    <h2>📝 結果ログ</h2>
    <div id="logOutput" style="background: #f8f9fa; padding: 15px; border-radius: 5px; height: 200px; overflow-y: auto;"></div>

    <!-- 必要なスクリプトを読み込み -->
    <script src="exam-data.js"></script>
    <script src="mega-kanji-database-1.js"></script>
    <script src="mega-kanji-database-2.js"></script>
    <script src="mega-kanji-database-3.js"></script>
    <script src="mega-kanji-database-4.js"></script>
    <script src="mega-kanji-database-5.js"></script>
    <script src="mega-database-final.js"></script>
    <script src="option-randomizer.js"></script>
    <script src="kanji-grade-data.js"></script>
    <script src="app.js"></script>
    <script src="enhanced-app.js"></script>
    <script src="simple-effects.js"></script>

    <script>
        function log(message, type = 'info') {
            const logDiv = document.getElementById('logOutput');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logDiv.textContent += logEntry;
            logDiv.scrollTop = logDiv.scrollHeight;
            
            if (type === 'error') {
                console.error(message);
            } else {
                console.log(message);
            }
        }

        function addTestResult(name, success, details = '') {
            const resultsDiv = document.getElementById('testResults');
            const result = document.createElement('div');
            result.className = `test-result ${success ? 'success' : 'error'}`;
            result.innerHTML = `
                <strong>${success ? '✅' : '❌'} ${name}</strong><br>
                ${details}
            `;
            resultsDiv.appendChild(result);
        }

        // 自動テスト実行
        window.addEventListener('DOMContentLoaded', () => {
            log('🚀 デバッグテスト開始');
            
            setTimeout(() => {
                runAutomaticTests();
            }, 1000);
        });

        function runAutomaticTests() {
            // 1. 基本変数の存在確認
            const hasUserData = typeof userData !== 'undefined';
            addTestResult('ユーザーデータ', hasUserData, hasUserData ? `レベル: ${userData.level}` : 'userData未定義');
            log(`ユーザーデータ確認: ${hasUserData ? '正常' : 'エラー'}`);

            // 2. 漢字データベース確認
            const hasKanjiQuestions = typeof kanjiQuestions !== 'undefined';
            const kanjiCount = hasKanjiQuestions ? kanjiQuestions.length : 0;
            addTestResult('漢字データベース', kanjiCount > 100, `問題数: ${kanjiCount}問`);
            log(`漢字データベース: ${kanjiCount}問`);

            // 3. 関数の存在確認
            const functions = [
                'startKanjiPractice', 'startReading', 'startVocabulary', 'startAIPractice',
                'showAnswerFeedback', 'updateUI', 'saveUserData', 'loadUserData'
            ];
            
            functions.forEach(funcName => {
                const exists = typeof window[funcName] === 'function';
                addTestResult(`関数: ${funcName}`, exists, exists ? '定義済み' : '未定義');
                log(`${funcName}: ${exists ? '✅' : '❌'}`);
            });

            // 4. DOM要素の存在確認
            const elements = ['app', 'mainScreen', 'kanjiScreen', 'readingScreen'];
            elements.forEach(id => {
                const exists = document.getElementById(id) !== null;
                addTestResult(`DOM要素: ${id}`, exists, exists ? '存在' : '未存在');
                log(`${id}: ${exists ? '✅' : '❌'}`);
            });

            // 5. CSS読み込み確認
            const cssLoaded = document.querySelector('link[href*="refined-ui.css"]') !== null;
            addTestResult('CSSファイル', cssLoaded, cssLoaded ? 'refined-ui.css読み込み済み' : 'CSS未読み込み');
            log(`CSS読み込み: ${cssLoaded ? '✅' : '❌'}`);

            log('🏁 自動テスト完了');
        }

        // 手動テスト関数
        function testKanjiButton() {
            log('🧪 漢字練習ボタンテスト開始');
            try {
                if (typeof startKanjiPractice === 'function') {
                    startKanjiPractice();
                    log('✅ 漢字練習ボタン正常動作');
                    addTestResult('漢字練習ボタン', true, '正常に動作');
                } else {
                    log('❌ startKanjiPractice関数が未定義');
                    addTestResult('漢字練習ボタン', false, 'startKanjiPractice関数未定義');
                }
            } catch (error) {
                log(`❌ 漢字練習ボタンエラー: ${error.message}`);
                addTestResult('漢字練習ボタン', false, `エラー: ${error.message}`);
            }
        }

        function testReadingButton() {
            log('🧪 読解問題ボタンテスト開始');
            try {
                if (typeof startReading === 'function') {
                    startReading();
                    log('✅ 読解問題ボタン正常動作');
                    addTestResult('読解問題ボタン', true, '正常に動作');
                } else {
                    log('❌ startReading関数が未定義');
                    addTestResult('読解問題ボタン', false, 'startReading関数未定義');
                }
            } catch (error) {
                log(`❌ 読解問題ボタンエラー: ${error.message}`);
                addTestResult('読解問題ボタン', false, `エラー: ${error.message}`);
            }
        }

        function testVocabularyButton() {
            log('🧪 語彙力ボタンテスト開始');
            try {
                if (typeof startVocabulary === 'function') {
                    startVocabulary();
                    log('✅ 語彙力ボタン正常動作');
                    addTestResult('語彙力ボタン', true, '正常に動作');
                } else {
                    log('❌ startVocabulary関数が未定義');
                    addTestResult('語彙力ボタン', false, 'startVocabulary関数未定義');
                }
            } catch (error) {
                log(`❌ 語彙力ボタンエラー: ${error.message}`);
                addTestResult('語彙力ボタン', false, `エラー: ${error.message}`);
            }
        }

        function testAIButton() {
            log('🧪 AI問題生成ボタンテスト開始');
            try {
                if (typeof startAIPractice === 'function') {
                    startAIPractice();
                    log('✅ AI問題生成ボタン正常動作');
                    addTestResult('AI問題生成ボタン', true, '正常に動作');
                } else {
                    log('❌ startAIPractice関数が未定義');
                    addTestResult('AI問題生成ボタン', false, 'startAIPractice関数未定義');
                }
            } catch (error) {
                log(`❌ AI問題生成ボタンエラー: ${error.message}`);
                addTestResult('AI問題生成ボタン', false, `エラー: ${error.message}`);
            }
        }
    </script>
</body>
</html>