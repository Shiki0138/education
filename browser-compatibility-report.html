<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ブラウザ互換性テストレポート</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        h1, h2 { color: #2c3e50; }
        .test-section {
            margin: 25px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #3498db;
        }
        .success { color: #27ae60; font-weight: bold; }
        .error { color: #e74c3c; font-weight: bold; }
        .warning { color: #f39c12; font-weight: bold; }
        .info { color: #3498db; font-weight: bold; }
        .test-button {
            background: #3498db;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 8px;
            cursor: pointer;
            margin: 10px 5px;
            font-size: 14px;
            transition: background 0.3s;
        }
        .test-button:hover { background: #2980b9; }
        .test-button.danger {
            background: #e74c3c;
        }
        .test-button.danger:hover { background: #c0392b; }
        .code-block {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            margin: 10px 0;
        }
        .status-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
            vertical-align: middle;
        }
        .status-success { background: #27ae60; }
        .status-error { background: #e74c3c; }
        .status-warning { background: #f39c12; }
        .status-info { background: #3498db; }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin: 15px 0;
        }
        .results-table th, .results-table td {
            border: 1px solid #ddd;
            padding: 12px;
            text-align: left;
        }
        .results-table th {
            background: #34495e;
            color: white;
        }
        .results-table tr:nth-child(even) {
            background: #f2f2f2;
        }
        .accordion {
            margin: 10px 0;
        }
        .accordion-header {
            background: #34495e;
            color: white;
            padding: 15px;
            cursor: pointer;
            border-radius: 8px;
            margin-bottom: 5px;
        }
        .accordion-content {
            display: none;
            padding: 15px;
            background: #ecf0f1;
            border-radius: 8px;
        }
        .accordion.active .accordion-content {
            display: block;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔍 漢字練習ボタン - ブラウザ互換性テストレポート</h1>
        <p><strong>対象URL:</strong> <a href="https://shiki0138.github.io/education/" target="_blank">https://shiki0138.github.io/education/</a></p>
        <p><strong>テスト実行時刻:</strong> <span id="currentTime"></span></p>
        
        <div class="test-section">
            <h2>🎯 テスト概要</h2>
            <p>このレポートは漢字練習ボタンが反応しない問題を詳細に調査した結果です。以下のポイントを重点的に検証しました：</p>
            <ul>
                <li>JavaScript実行環境の確認</li>
                <li>onclick属性とstartKanji()関数の関係性</li>
                <li>ブラウザ固有の制限・セキュリティポリシー</li>
                <li>モバイル・デスクトップでの動作差異</li>
                <li>外部ライブラリの影響</li>
                <li>GitHub Pagesの配信ヘッダー</li>
            </ul>
        </div>

        <div class="test-section">
            <h2>📊 リアルタイム診断テスト</h2>
            <p>以下のボタンを押して現在のブラウザ環境で診断を実行してください：</p>
            
            <button class="test-button" onclick="runEnvironmentTest()">🔍 環境診断</button>
            <button class="test-button" onclick="runKanjiFunctionTest()">📝 startKanji関数テスト</button>
            <button class="test-button" onclick="runEventTest()">🎯 イベントテスト</button>
            <button class="test-button" onclick="runSecurityTest()">🛡️ セキュリティテスト</button>
            <button class="test-button danger" onclick="runActualKanjiButton()">⚠️ 実際のボタンテスト</button>
            
            <div id="testResults" style="margin-top: 20px;"></div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                📋 GitHub Pagesヘッダー分析結果
            </div>
            <div class="accordion-content">
                <table class="results-table">
                    <tr><th>ヘッダー項目</th><th>値</th><th>影響</th></tr>
                    <tr><td>Content-Security-Policy</td><td class="info">未設定</td><td class="success">inline-script制限なし</td></tr>
                    <tr><td>Cache-Control</td><td>max-age=600</td><td class="warning">10分キャッシュ</td></tr>
                    <tr><td>Server</td><td>GitHub.com</td><td class="success">正常配信</td></tr>
                    <tr><td>Content-Type</td><td>text/html; charset=utf-8</td><td class="success">正常</td></tr>
                </table>
                
                <h4>分析結果：</h4>
                <ul>
                    <li class="success">✅ CSPによるinline-script制限はありません</li>
                    <li class="warning">⚠️ 10分間のキャッシュが設定されています</li>
                    <li class="success">✅ 適切なContent-Typeが設定されています</li>
                </ul>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                💻 コードレベル分析結果
            </div>
            <div class="accordion-content">
                <h4>HTML構造確認：</h4>
                <div class="code-block">
&lt;button class="menu-btn" onclick="startKanji()"&gt;
    &lt;span class="menu-icon"&gt;📝&lt;/span&gt;
    &lt;div&gt;&lt;strong&gt;漢字練習&lt;/strong&gt;&lt;/div&gt;
    &lt;div&gt;基本漢字をマスター&lt;/div&gt;
&lt;/button&gt;
                </div>

                <h4>JavaScript関数定義確認：</h4>
                <div class="code-block">
function startKanji() {
    console.log('📝 漢字練習開始（シンプル版）');
    currentQuestion = 0;
    score = 0;
    showScreen('kanjiScreen');
    showKanjiQuestion();
}
                </div>

                <h4>分析結果：</h4>
                <ul>
                    <li class="success">✅ onclick属性は正しく設定されています</li>
                    <li class="success">✅ startKanji()関数は適切に定義されています</li>
                    <li class="success">✅ 必要なDOM要素は存在します</li>
                    <li class="info">ℹ️ 追加のイベントリスナーも設定されています</li>
                </ul>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                🌐 ブラウザ別動作確認結果
            </div>
            <div class="accordion-content">
                <table class="results-table">
                    <tr><th>ブラウザ</th><th>デスクトップ</th><th>モバイル</th><th>特記事項</th></tr>
                    <tr>
                        <td>Chrome</td>
                        <td><span class="status-indicator status-success"></span>動作予想：正常</td>
                        <td><span class="status-indicator status-success"></span>動作予想：正常</td>
                        <td>最も互換性が高い</td>
                    </tr>
                    <tr>
                        <td>Safari</td>
                        <td><span class="status-indicator status-warning"></span>要確認</td>
                        <td><span class="status-indicator status-warning"></span>要確認</td>
                        <td>Webkit固有の制限の可能性</td>
                    </tr>
                    <tr>
                        <td>Firefox</td>
                        <td><span class="status-indicator status-success"></span>動作予想：正常</td>
                        <td><span class="status-indicator status-success"></span>動作予想：正常</td>
                        <td>標準準拠で問題なし</td>
                    </tr>
                    <tr>
                        <td>Edge</td>
                        <td><span class="status-indicator status-success"></span>動作予想：正常</td>
                        <td><span class="status-indicator status-info"></span>テスト要</td>
                        <td>Chromiumベース</td>
                    </tr>
                </table>
            </div>
        </div>

        <div class="accordion">
            <div class="accordion-header" onclick="toggleAccordion(this)">
                🔧 推奨解決策
            </div>
            <div class="accordion-content">
                <h4>即座に試せる解決策：</h4>
                <ol>
                    <li class="warning"><strong>ハードリロード実行</strong> - Ctrl+Shift+R (Windows) / Cmd+Shift+R (Mac)</li>
                    <li class="info"><strong>ブラウザキャッシュクリア</strong> - 設定 > プライバシー > 閲覧データの削除</li>
                    <li class="info"><strong>他のブラウザでテスト</strong> - Chrome、Safari、Firefoxでそれぞれ確認</li>
                    <li class="info"><strong>モバイル・デスクトップ両方でテスト</strong></li>
                </ol>

                <h4>開発者向け詳細解決策：</h4>
                <ol>
                    <li><strong>イベントリスナーの重複チェック</strong> - addEventListener と onclick の競合確認</li>
                    <li><strong>スクリプト読み込み順序の最適化</strong> - DOM Ready後の初期化確認</li>
                    <li><strong>エラーハンドリングの強化</strong> - try-catch文での例外処理追加</li>
                    <li><strong>Polyfillの追加</strong> - 古いブラウザ対応のための互換性ライブラリ</li>
                </ol>

                <h4>推奨コード改善案：</h4>
                <div class="code-block">
// より確実なイベント設定
document.addEventListener('DOMContentLoaded', function() {
    const kanjiBtn = document.querySelector('[onclick*="startKanji"]');
    if (kanjiBtn) {
        // onclick属性に加えて、addEventListener も設定
        kanjiBtn.addEventListener('click', function(e) {
            e.preventDefault();
            if (typeof startKanji === 'function') {
                startKanji();
            } else {
                console.error('startKanji function not found');
            }
        });
        console.log('✅ 漢字ボタンイベント設定完了');
    }
});
                </div>
            </div>
        </div>

        <div class="test-section">
            <h2>📱 モバイル固有テスト</h2>
            <p id="mobileTestResults">モバイル環境検出中...</p>
            <button class="test-button" onclick="runMobileSpecificTest()">📱 モバイルテスト実行</button>
        </div>

        <div class="test-section">
            <h2>🚨 緊急対応手順</h2>
            <div style="background: #ffe6e6; padding: 15px; border-radius: 8px; border-left: 5px solid #e74c3c;">
                <h4>問題が解決しない場合：</h4>
                <ol>
                    <li>ブラウザの開発者ツールを開く (F12)</li>
                    <li>Consoleタブでエラーメッセージを確認</li>
                    <li>Networkタブでリソース読み込み状況を確認</li>
                    <li>以下のコードを直接コンソールに貼り付けて実行：</li>
                </ol>
                <div class="code-block">
// 緊急診断コード
console.log('緊急診断開始');
console.log('startKanji関数存在:', typeof startKanji === 'function');
document.querySelectorAll('[onclick*="startKanji"]').forEach((btn, i) => {
    console.log(`ボタン${i+1}:`, btn.onclick, btn.getAttribute('onclick'));
});
                </div>
            </div>
        </div>
    </div>

    <script>
        // 現在時刻表示
        document.getElementById('currentTime').textContent = new Date().toLocaleString('ja-JP');

        // アコーディオン機能
        function toggleAccordion(header) {
            const accordion = header.parentElement;
            accordion.classList.toggle('active');
        }

        // 環境診断テスト
        function runEnvironmentTest() {
            const results = document.getElementById('testResults');
            let html = '<h3>🔍 環境診断結果</h3>';
            
            html += `<p><span class="status-indicator ${navigator.onLine ? 'status-success' : 'status-error'}"></span>ネットワーク: ${navigator.onLine ? 'オンライン' : 'オフライン'}</p>`;
            html += `<p><span class="status-indicator status-info"></span>ユーザーエージェント: ${navigator.userAgent}</p>`;
            html += `<p><span class="status-indicator status-info"></span>画面サイズ: ${window.innerWidth}x${window.innerHeight}</p>`;
            html += `<p><span class="status-indicator status-info"></span>デバイスピクセル比: ${window.devicePixelRatio}</p>`;
            
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            html += `<p><span class="status-indicator ${isMobile ? 'status-warning' : 'status-success'}"></span>デバイス: ${isMobile ? 'モバイル' : 'デスクトップ'}</p>`;
            
            results.innerHTML = html;
        }

        // startKanji関数テスト
        function runKanjiFunctionTest() {
            const results = document.getElementById('testResults');
            let html = '<h3>📝 startKanji関数テスト結果</h3>';
            
            if (typeof startKanji === 'function') {
                html += `<p><span class="status-indicator status-success"></span>startKanji関数: 定義済み</p>`;
                html += `<p><span class="status-indicator status-info"></span>関数長: ${startKanji.toString().length}文字</p>`;
            } else {
                html += `<p><span class="status-indicator status-error"></span>startKanji関数: 未定義</p>`;
                html += `<p class="error">⚠️ 重大な問題：startKanji関数が見つかりません</p>`;
            }
            
            const kanjiButtons = document.querySelectorAll('[onclick*="startKanji"]');
            html += `<p><span class="status-indicator status-info"></span>漢字練習ボタン数: ${kanjiButtons.length}個</p>`;
            
            results.innerHTML = html;
        }

        // イベントテスト
        function runEventTest() {
            const results = document.getElementById('testResults');
            let html = '<h3>🎯 イベントテスト結果</h3>';
            
            const kanjiButtons = document.querySelectorAll('[onclick*="startKanji"]');
            
            if (kanjiButtons.length > 0) {
                kanjiButtons.forEach((btn, index) => {
                    const onclick = btn.getAttribute('onclick');
                    html += `<p><span class="status-indicator status-info"></span>ボタン${index + 1} onclick: ${onclick}</p>`;
                    
                    // クリック可能性テスト
                    const style = window.getComputedStyle(btn);
                    const isVisible = style.display !== 'none' && style.visibility !== 'hidden';
                    const isEnabled = !btn.disabled;
                    
                    html += `<p><span class="status-indicator ${isVisible && isEnabled ? 'status-success' : 'status-error'}"></span>ボタン${index + 1} 状態: ${isVisible && isEnabled ? '正常' : '無効'}</p>`;
                });
            } else {
                html += `<p><span class="status-indicator status-error"></span>漢字練習ボタンが見つかりません</p>`;
            }
            
            results.innerHTML = html;
        }

        // セキュリティテスト
        function runSecurityTest() {
            const results = document.getElementById('testResults');
            let html = '<h3>🛡️ セキュリティテスト結果</h3>';
            
            // CSPチェック
            const cspMeta = document.querySelector('meta[http-equiv="Content-Security-Policy"]');
            if (cspMeta) {
                html += `<p><span class="status-indicator status-warning"></span>CSP検出: ${cspMeta.content.substring(0, 50)}...</p>`;
            } else {
                html += `<p><span class="status-indicator status-success"></span>CSP: 制限なし</p>`;
            }
            
            // eval テスト
            try {
                eval('1+1');
                html += `<p><span class="status-indicator status-success"></span>eval(): 実行可能</p>`;
            } catch (e) {
                html += `<p><span class="status-indicator status-error"></span>eval(): 制限あり - ${e.message}</p>`;
            }
            
            results.innerHTML = html;
        }

        // 実際のボタンテスト
        function runActualKanjiButton() {
            const results = document.getElementById('testResults');
            let html = '<h3>⚠️ 実際のボタンテスト結果</h3>';
            
            if (typeof startKanji === 'function') {
                html += `<p><span class="status-indicator status-success"></span>関数実行準備完了</p>`;
                html += `<p><span class="status-indicator status-info"></span>3秒後に自動でstartKanji()を実行します...</p>`;
                
                setTimeout(() => {
                    try {
                        startKanji();
                        html += `<p><span class="status-indicator status-success"></span>✅ startKanji()実行成功！</p>`;
                    } catch (e) {
                        html += `<p><span class="status-indicator status-error"></span>❌ 実行エラー: ${e.message}</p>`;
                    }
                    document.getElementById('testResults').innerHTML = html;
                }, 3000);
            } else {
                html += `<p><span class="status-indicator status-error"></span>❌ startKanji関数が見つからないため実行できません</p>`;
            }
            
            results.innerHTML = html;
        }

        // モバイル固有テスト
        function runMobileSpecificTest() {
            const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            const hasTouch = 'ontouchstart' in window;
            const orientation = window.innerHeight > window.innerWidth ? 'Portrait' : 'Landscape';
            
            let html = '';
            if (isMobile) {
                html += `<span class="warning">📱 モバイルデバイス検出</span><br>`;
                html += `タッチサポート: ${hasTouch ? 'あり' : 'なし'}<br>`;
                html += `画面向き: ${orientation}<br>`;
                html += `ビューポート: ${window.innerWidth}x${window.innerHeight}<br>`;
                
                if (hasTouch) {
                    html += `<span class="success">✅ タッチイベントに対応しています</span><br>`;
                } else {
                    html += `<span class="warning">⚠️ タッチイベントが利用できない可能性があります</span><br>`;
                }
            } else {
                html += `<span class="info">💻 デスクトップ環境です</span><br>`;
                html += `マウスイベントが利用可能です<br>`;
            }
            
            document.getElementById('mobileTestResults').innerHTML = html;
        }

        // startKanji関数のモック（存在しない場合のため）
        if (typeof startKanji === 'undefined') {
            function startKanji() {
                alert('🎉 startKanji()関数が正常に実行されました！\n\nこれはテスト用のモック関数です。\n実際のアプリケーションでは漢字練習画面に遷移します。');
                console.log('📝 テスト用startKanji関数実行');
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            runEnvironmentTest();
            runMobileSpecificTest();
        });
    </script>
</body>
</html>