<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åˆæ ¼ã¸ã®é“ - å›½èªå­¦ç¿’ã‚¢ãƒ—ãƒªï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1976d2, #1565c0);
            color: white;
            border-radius: 15px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-btn {
            background: linear-gradient(135deg, #bbdefb, #e3f2fd);
            border: 2px solid #90caf9;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 16px;
            color: #1565c0;
        }

        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.2);
        }

        .menu-icon {
            font-size: 36px;
            margin-bottom: 10px;
            display: block;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .practice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e3f2fd;
        }

        .back-btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option-btn {
            background: #e3f2fd;
            border: 2px solid #90caf9;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .option-btn:hover {
            background: #bbdefb;
        }

        .option-btn.correct {
            background: #c8e6c9;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .option-btn.incorrect {
            background: #ffcdd2;
            border-color: #f44336;
            color: #c62828;
        }

        .result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 10000;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            display: none;
        }

        .result-popup.show {
            display: block;
            animation: popupShow 0.3s ease-out;
        }

        @keyframes popupShow {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .result-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .debug-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10000;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- ãƒ¡ã‚¤ãƒ³ç”»é¢ -->
        <div id="mainScreen" class="screen active">
            <div class="header">
                <h1>ğŸ“š åˆæ ¼ã¸ã®é“</h1>
                <p>ä¸­å­¦å—é¨“å›½èªå­¦ç¿’ã‚¢ãƒ—ãƒª</p>
                <div>Lv.<span id="userLevel">1</span> | <span id="streakDays">0</span>æ—¥é€£ç¶š</div>
            </div>

            <div class="menu-grid">
                <button class="menu-btn" onclick="startKanji()">
                    <span class="menu-icon">ğŸ“</span>
                    <div><strong>æ¼¢å­—ç·´ç¿’</strong></div>
                    <div>åŸºæœ¬æ¼¢å­—ã‚’ãƒã‚¹ã‚¿ãƒ¼</div>
                </button>
                <button class="menu-btn" onclick="startReading()">
                    <span class="menu-icon">ğŸ“–</span>
                    <div><strong>èª­è§£å•é¡Œ</strong></div>
                    <div>æ–‡ç« ç†è§£åŠ›ã‚’é›ãˆã‚‹</div>
                </button>
                <button class="menu-btn" onclick="startVocab()">
                    <span class="menu-icon">ğŸ’¬</span>
                    <div><strong>èªå½™åŠ›å¼·åŒ–</strong></div>
                    <div>ã“ã¨ã‚ã–ãƒ»æ…£ç”¨å¥</div>
                </button>
                <button class="menu-btn" onclick="startAI()">
                    <span class="menu-icon">ğŸ¤–</span>
                    <div><strong>AIå•é¡Œç”Ÿæˆ</strong></div>
                    <div>å€‹äººæœ€é©åŒ–å•é¡Œ</div>
                </button>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <div>ğŸ“Š ä»Šæ—¥ã®é€²æ—: <span id="todayProgress">0/30åˆ†</span></div>
                <div>â­ ãƒã‚¤ãƒ³ãƒˆ: <span id="totalPoints">0</span>pt</div>
                <div>ğŸ¯ æ­£ç­”ç‡: <span id="accuracy">0</span>%</div>
            </div>
        </div>

        <!-- æ¼¢å­—ç·´ç¿’ç”»é¢ -->
        <div id="kanjiScreen" class="screen">
            <div class="practice-header">
                <button class="back-btn" onclick="goHome()">â† æˆ»ã‚‹</button>
                <h2>ğŸ“ æ¼¢å­—ç·´ç¿’</h2>
                <div>ã‚¹ã‚³ã‚¢: <span id="score">0</span>ç‚¹</div>
            </div>

            <div class="question-card">
                <div>å•é¡Œ <span id="questionNum">1</span> / 10</div>
                <div class="question-text" id="questionText">
                    èª­ã¿è¾¼ã¿ä¸­...
                </div>
                <div class="options" id="optionsContainer">
                    <!-- é¸æŠè‚¢ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>

            <div style="text-align: center;">
                <button onclick="showHint()" style="background: #ffc107; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                    ğŸ’¡ ãƒ’ãƒ³ãƒˆ
                </button>
                <div id="hintText" style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 10px; display: none;"></div>
            </div>
        </div>

        <!-- èª­è§£å•é¡Œç”»é¢ -->
        <div id="readingScreen" class="screen">
            <div class="practice-header">
                <button class="back-btn" onclick="goHome()">â† æˆ»ã‚‹</button>
                <h2>ğŸ“– èª­è§£å•é¡Œ</h2>
                <div>å•é¡Œ <span id="readingNum">1</span> / 3</div>
            </div>

            <div class="question-card">
                <div id="passageContainer" style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin-bottom: 15px; line-height: 1.8; font-size: 14px;">
                    <!-- æ–‡ç« ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
                <div class="question-text" id="readingQuestionText">
                    èª­ã¿è¾¼ã¿ä¸­...
                </div>
                <div class="options" id="readingOptionsContainer">
                    <!-- é¸æŠè‚¢ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>
        </div>

        <!-- èªå½™åŠ›å¼·åŒ–ç”»é¢ -->
        <div id="vocabularyScreen" class="screen">
            <div class="practice-header">
                <button class="back-btn" onclick="goHome()">â† æˆ»ã‚‹</button>
                <h2>ğŸ’¬ å››å­—ç†Ÿèªãƒ»ã“ã¨ã‚ã–</h2>
                <div>å•é¡Œ <span id="vocabNum">1</span> / 5</div>
            </div>

            <div class="question-card">
                <div class="question-text" id="vocabQuestionText">
                    èª­ã¿è¾¼ã¿ä¸­...
                </div>
                <div class="options" id="vocabOptionsContainer">
                    <!-- é¸æŠè‚¢ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
            </div>
        </div>

        <!-- è¨˜è¿°å•é¡Œç”»é¢ -->
        <div id="writingScreen" class="screen">
            <div class="practice-header">
                <button class="back-btn" onclick="goHome()">â† æˆ»ã‚‹</button>
                <h2>âœï¸ è¨˜è¿°å•é¡Œ</h2>
                <div>å•é¡Œ <span id="writingNum">1</span> / 2</div>
            </div>

            <div class="question-card">
                <div id="writingPassage" style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin-bottom: 15px; line-height: 1.6; font-size: 14px;">
                    <!-- æ–‡ç« ãŒã“ã“ã«è¡¨ç¤ºã•ã‚Œã‚‹ -->
                </div>
                <div class="question-text" id="writingQuestionText">
                    èª­ã¿è¾¼ã¿ä¸­...
                </div>
                <div style="margin: 15px 0;">
                    <textarea id="writingAnswer" placeholder="ã“ã“ã«ç­”ãˆã‚’æ›¸ã„ã¦ãã ã•ã„" 
                              style="width: 100%; height: 120px; padding: 10px; border: 2px solid #90caf9; 
                                     border-radius: 10px; font-size: 16px; resize: vertical;"></textarea>
                    <div style="text-align: right; margin-top: 5px; font-size: 14px; color: #666;">
                        <span id="charCount">0</span> / <span id="maxChars">80</span> å­—
                    </div>
                </div>
                <div style="text-align: center;">
                    <button onclick="submitWriting()" style="background: #1976d2; color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-size: 16px;">
                        è§£ç­”æå‡º
                    </button>
                </div>
            </div>
        </div>

        <!-- çµæœãƒãƒƒãƒ—ã‚¢ãƒƒãƒ— -->
        <div id="resultPopup" class="result-popup">
            <div class="result-icon" id="resultIcon">ğŸ‰</div>
            <div id="resultMessage"></div>
            <button onclick="nextQuestion()" style="margin-top: 20px; padding: 10px 20px; background: #1976d2; color: white; border: none; border-radius: 10px; cursor: pointer;">
                æ¬¡ã®å•é¡Œ
            </button>
        </div>
    </div>

    <!-- ãƒ‡ãƒãƒƒã‚°æƒ…å ± -->
    <div class="debug-info" id="debugInfo">
        ã‚¢ãƒ—ãƒªçŠ¶æ…‹: <span id="appStatus">èª­ã¿è¾¼ã¿ä¸­...</span>
    </div>

    <script>
        // ã‚·ãƒ³ãƒ—ãƒ«ã§ç¢ºå®Ÿã«å‹•ä½œã™ã‚‹ã‚³ãƒ¼ãƒ‰
        console.log('ğŸš€ ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã‚¢ãƒ—ãƒªé–‹å§‹');

        // åŸºæœ¬ãƒ‡ãƒ¼ã‚¿
        let currentQuestion = 0;
        let score = 0;
        let userData = {
            level: 1,
            points: 0,
            streak: 0,
            accuracy: 0,
            questionsToday: 0,
            correctToday: 0
        };

        // ä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«ï¼ˆåå·®å€¤50ï¼‰æ¼¢å­—å•é¡Œ
        const kanjiProblems = [
            {
                question: "å‚ç·šéƒ¨ã®æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç­”ãˆãªã•ã„ï¼šå½¼ã®ã€å“è¶Šã€‘ã—ãŸæŠ€è¡“ã«é©šã„ãŸã€‚",
                options: ["ãŸããˆã¤", "ãŸãã“ã—", "ã—ã‚‡ã†ãˆã¤", "ãŸããœã¤"],
                correct: 0,
                hint: "ã€Œå“ã€ã¯ã€Œã™ãã‚Œã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™",
                explanation: "å“è¶Šï¼ˆãŸããˆã¤ï¼‰= ä»–ã‚ˆã‚Šã‚‚ç‰¹ã«å„ªã‚Œã¦ã„ã‚‹ã“ã¨"
            },
            {
                question: "å‚ç·šéƒ¨ã®æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç­”ãˆãªã•ã„ï¼šã€é€¸è©±ã€‘ã¨ã—ã¦èªã‚Šç¶™ãŒã‚Œã¦ã„ã‚‹ã€‚",
                options: ["ã„ã¤ã‚", "ã„ã¡ã‚", "ã„ã¤ã ã‚“", "ã„ã¡ã ã‚“"],
                correct: 0,
                hint: "ä¸–é–“ã«ã‚ã¾ã‚ŠçŸ¥ã‚‰ã‚Œã¦ã„ãªã„èˆˆå‘³æ·±ã„è©±ã§ã™",
                explanation: "é€¸è©±ï¼ˆã„ã¤ã‚ï¼‰= ä¸–é–“ã«ã‚ã¾ã‚ŠçŸ¥ã‚‰ã‚Œã¦ã„ãªã„èˆˆå‘³æ·±ã„è©±"
            },
            {
                question: "å‚ç·šéƒ¨ã®æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç­”ãˆãªã•ã„ï¼šã€è¬™éœã€‘ã—ã¦è‡ªåˆ†ã®å®ŸåŠ›ã‚’éš ã—ãŸã€‚",
                options: ["ã‘ã‚“ãã‚“", "ã‘ã‚“ã˜ã‚‡ã†", "ãã‚‡ã†ãã‚“", "ã‘ã‚“ã—ã‚‡ã†"],
                correct: 0,
                hint: "ã€Œè¬™ã€ã¯ã€Œã¸ã‚Šãã ã‚‹ã€ã¨ã„ã†æ„å‘³ã§ã™",
                explanation: "è¬™éœï¼ˆã‘ã‚“ãã‚“ï¼‰= æ§ãˆã‚ãªæ…‹åº¦ã‚’ã¨ã‚‹ã“ã¨"
            },
            {
                question: "å‚ç·šéƒ¨ã®æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç­”ãˆãªã•ã„ï¼šã€æ´å¯Ÿã€‘åŠ›ã‚’èº«ã«ã¤ã‘ã‚‹ã€‚",
                options: ["ã¨ã†ã•ã¤", "ã©ã†ã‹ã¤", "ã¨ã†ã‹ã¤", "ã©ã†ã•ã¤"],
                correct: 3,
                hint: "ç‰©äº‹ã®æœ¬è³ªã‚’è¦‹æŠœãã“ã¨ã§ã™",
                explanation: "æ´å¯Ÿï¼ˆã©ã†ã•ã¤ï¼‰= ç‰©äº‹ã®æœ¬è³ªã‚’è¦‹æŠœãã“ã¨"
            },
            {
                question: "å‚ç·šéƒ¨ã®æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç­”ãˆãªã•ã„ï¼šå¿ƒã®ã€è‘›è—¤ã€‘ã«è‹¦ã—ã‚“ã ã€‚",
                options: ["ã‹ã¤ã¨ã†", "ã‹ã£ã¨ã†", "ããšã¨ã†", "ã‹ã¤ã©ã†"],
                correct: 1,
                hint: "ç›¸åã™ã‚‹æ°—æŒã¡ã§æ‚©ã‚€ã“ã¨ã§ã™",
                explanation: "è‘›è—¤ï¼ˆã‹ã£ã¨ã†ï¼‰= ç›¸åã™ã‚‹æ°—æŒã¡ã§æ‚©ã‚€ã“ã¨"
            },
            {
                question: "å‚ç·šéƒ¨ã®æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç­”ãˆãªã•ã„ï¼šå°†æ¥ã‚’ã€æ†‚æ…®ã€‘ã—ã¦ã„ã‚‹ã€‚",
                options: ["ã‚†ã†ã‚", "ã†ã‚Šã‚‡", "ã‚†ã‚Šã‚‡", "ã‚†ã†ã‚Šã‚‡"],
                correct: 3,
                hint: "å¿ƒé…ã—ã¦æ€ã„æ‚©ã‚€ã“ã¨ã§ã™",
                explanation: "æ†‚æ…®ï¼ˆã‚†ã†ã‚Šã‚‡ï¼‰= å¿ƒé…ã—ã¦æ€ã„æ‚©ã‚€ã“ã¨"
            },
            {
                question: "å‚ç·šéƒ¨ã®æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç­”ãˆãªã•ã„ï¼šç›®æ¨™ã«å‘ã‹ã£ã¦ã€é‚é€²ã€‘ã™ã‚‹ã€‚",
                options: ["ã¾ã„ã—ã‚“", "ã¾ã„ã˜ã‚“", "ã°ã„ã—ã‚“", "ã°ã„ã˜ã‚“"],
                correct: 0,
                hint: "ç›®æ¨™ã«å‘ã‹ã£ã¦å‹¢ã„ã‚ˆãé€²ã‚€ã“ã¨ã§ã™",
                explanation: "é‚é€²ï¼ˆã¾ã„ã—ã‚“ï¼‰= ç›®æ¨™ã«å‘ã‹ã£ã¦å‹¢ã„ã‚ˆãé€²ã‚€ã“ã¨"
            },
            {
                question: "å‚ç·šéƒ¨ã®æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç­”ãˆãªã•ã„ï¼šä»–ã‚’ã€å‡Œé§•ã€‘ã™ã‚‹å®ŸåŠ›ã€‚",
                options: ["ã‚Šã‚“ãŒ", "ã‚Šã‚‡ã†ã‹", "ã‚Šã‚‡ã†ãŒ", "ã‚Šã‚“ã‹"],
                correct: 2,
                hint: "ä»–ã‚’ä¸Šå›ã£ã¦å„ªã‚Œã‚‹ã“ã¨ã§ã™",
                explanation: "å‡Œé§•ï¼ˆã‚Šã‚‡ã†ãŒï¼‰= ä»–ã‚’ä¸Šå›ã£ã¦å„ªã‚Œã‚‹ã“ã¨"
            },
            {
                question: "å‚ç·šéƒ¨ã®æ¼¢å­—ã®èª­ã¿æ–¹ã‚’ç­”ãˆãªã•ã„ï¼šã€é¡•è‘—ã€‘ãªæˆæœã‚’ä¸Šã’ãŸã€‚",
                options: ["ã‘ã‚“ã¡ã‚‡", "ã‘ã‚“ã¡ã‚ƒã", "ã‚ãã‚‰ã‹", "ã‚ã ã¤"],
                correct: 0,
                hint: "ã¯ã£ãã‚Šã¨ç›®ç«‹ã¤ã“ã¨ã§ã™",
                explanation: "é¡•è‘—ï¼ˆã‘ã‚“ã¡ã‚‡ï¼‰= ã¯ã£ãã‚Šã¨ç›®ç«‹ã¤ã“ã¨"
            },
            {
                question: "æ¬¡ã®æ–‡ã®ã€ã€€ã€‘ã«å…¥ã‚‹æ¼¢å­—ã‚’æ›¸ããªã•ã„ï¼šã“ã®è¨ˆç”»ã¯ã€ã‚¹ã‚¤ã‚³ã‚¦ã€‘ãŒå›°é›£ã ã€‚",
                options: ["æ¨è€ƒ", "é‚è¡Œ", "æ°´è¡Œ", "å‚è¡Œ"],
                correct: 1,
                hint: "ç‰©äº‹ã‚’æœ€å¾Œã¾ã§è¡Œã†ã“ã¨ã§ã™",
                explanation: "é‚è¡Œï¼ˆã™ã„ã“ã†ï¼‰= ç‰©äº‹ã‚’æœ€å¾Œã¾ã§è¡Œã†ã“ã¨"
            }
        ];

        // ä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«èª­è§£å•é¡Œï¼ˆåå·®å€¤50ï¼‰
        const readingProblems = [
            {
                passage: `äººå·¥çŸ¥èƒ½ï¼ˆAIï¼‰ã®ç™ºé”ã«ã‚ˆã‚Šã€ç§ãŸã¡ã®ç”Ÿæ´»ã¯å¤§ããå¤‰åŒ–ã—ã¦ã„ã¾ã™ã€‚è‡ªå‹•é‹è»¢è»Šã€éŸ³å£°èªè­˜ã‚·ã‚¹ãƒ†ãƒ ã€ç”»åƒè¨ºæ–­æŠ€è¡“ãªã©ã€AIã¯æ§˜ã€…ãªåˆ†é‡ã§æ´»ç”¨ã•ã‚Œã¦ã„ã¾ã™ã€‚\n\nã€€ã—ã‹ã—ã€AIã®æ™®åŠã«ã¯èª²é¡Œã‚‚ã‚ã‚Šã¾ã™ã€‚äººé–“ã®ä»•äº‹ãŒAIã«ç½®ãæ›ãˆã‚‰ã‚Œã‚‹å¯èƒ½æ€§ã‚„ã€AIæŠ€è¡“ã®èª¤ç”¨ã«ã‚ˆã‚‹ç¤¾ä¼šã¸ã®æ‚ªå½±éŸ¿ãªã©ãŒæ‡¸å¿µã•ã‚Œã¦ã„ã¾ã™ã€‚ã¾ãŸã€AIã®åˆ¤æ–­éç¨‹ãŒä¸é€æ˜ã§ã‚ã‚‹ã“ã¨ã‚‚å•é¡Œè¦–ã•ã‚Œã¦ã„ã¾ã™ã€‚\n\nã€€é‡è¦ãªã®ã¯ã€AIã‚’å˜ãªã‚‹é“å…·ã¨ã—ã¦æ‰ãˆã€äººé–“ãŒãã®ä½¿ã„æ–¹ã‚’é©åˆ‡ã«ç®¡ç†ã™ã‚‹ã“ã¨ã§ã™ã€‚AIæŠ€è¡“ã®æ©æµã‚’æœ€å¤§é™ã«æ´»ç”¨ã—ãªãŒã‚‰ã€äººé–“ã‚‰ã—ã•ã‚’å¤±ã‚ãªã„ç¤¾ä¼šã‚’ç¯‰ã„ã¦ã„ãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚`,
                question: "ç­†è€…ãŒAIã«ã¤ã„ã¦æœ€ã‚‚é‡è¦ã ã¨è€ƒãˆã¦ã„ã‚‹ã“ã¨ã¯ä½•ã§ã™ã‹ã€‚",
                options: [
                    "AIã®æŠ€è¡“ã‚’ã•ã‚‰ã«ç™ºé”ã•ã›ã‚‹ã“ã¨",
                    "AIã®èª²é¡Œã‚’å®Œå…¨ã«è§£æ±ºã™ã‚‹ã“ã¨",
                    "äººé–“ãŒAIã‚’é©åˆ‡ã«ç®¡ç†ã™ã‚‹ã“ã¨", 
                    "AIã¨äººé–“ã®åŒºåˆ¥ã‚’æ˜ç¢ºã«ã™ã‚‹ã“ã¨"
                ],
                correct: 2,
                explanation: "ç¬¬3æ®µè½ã§ã€Œäººé–“ãŒãã®ä½¿ã„æ–¹ã‚’é©åˆ‡ã«ç®¡ç†ã™ã‚‹ã“ã¨ã§ã™ã€ã¨è¿°ã¹ã‚‰ã‚Œã¦ã„ã¾ã™"
            },
            {
                passage: `æ±Ÿæˆ¸æ™‚ä»£ã®å‚å‹¤äº¤ä»£åˆ¶åº¦ã¯ã€å¾³å·å¹•åºœãŒå…¨å›½ã®å¤§åã‚’çµ±åˆ¶ã™ã‚‹ãŸã‚ã«è¨­ã‘ãŸåˆ¶åº¦ã§ã—ãŸã€‚å„è—©ã®å¤§åã¯ã€ä¸€å¹´ãŠãã«æ±Ÿæˆ¸ã¨é ˜åœ°ã‚’å¾€å¾©ã—ã€æ±Ÿæˆ¸ã«æ»åœ¨ä¸­ã¯å¹•åºœã®ç›£è¦–ä¸‹ã«ç½®ã‹ã‚Œã¾ã—ãŸã€‚\n\nã€€ã“ã®åˆ¶åº¦ã«ã‚ˆã‚Šã€å¤§åãŸã¡ã¯å¤šé¡ã®è²»ç”¨ã‚’äº¤é€šè²»ã‚„æ±Ÿæˆ¸ã§ã®ç”Ÿæ´»è²»ã«è²»ã‚„ã™ã“ã¨ã«ãªã‚Šã€çµŒæ¸ˆåŠ›ã‚’å‰ŠãŒã‚Œã¾ã—ãŸã€‚ã¾ãŸã€å¤§åã®å®¶æ—ã¯æ±Ÿæˆ¸ã«äººè³ªã¨ã—ã¦æ®‹ã•ã‚Œã€è¬€åã‚’èµ·ã“ã™ã“ã¨ãŒå›°é›£ã«ãªã‚Šã¾ã—ãŸã€‚\n\nã€€ä¸€æ–¹ã§ã€å‚å‹¤äº¤ä»£ã«ã‚ˆã‚Šå„åœ°ã®æ–‡åŒ–ã‚„æŠ€è¡“ã®äº¤æµãŒä¿ƒé€²ã•ã‚Œã€è¡—é“ã®æ•´å‚™ã‚„å®¿å ´ç”ºã®ç™ºé”ã«ã‚‚ã¤ãªãŒã‚Šã¾ã—ãŸã€‚æ±Ÿæˆ¸ã®äººå£å¢—åŠ ã‚„å•†æ¥­ã®ç™ºå±•ã«ã‚‚å¤§ããè²¢çŒ®ã—ãŸã®ã§ã™ã€‚`,
                question: "å‚å‹¤äº¤ä»£åˆ¶åº¦ã®ç›®çš„ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã¯ã©ã‚Œã§ã™ã‹ã€‚",
                options: [
                    "æ–‡åŒ–ã‚„æŠ€è¡“ã®äº¤æµã‚’ä¿ƒé€²ã™ã‚‹ã“ã¨",
                    "è¡—é“ã®æ•´å‚™ã‚„å®¿å ´ç”ºã‚’ç™ºé”ã•ã›ã‚‹ã“ã¨",
                    "æ±Ÿæˆ¸ã®äººå£ã‚’å¢—åŠ ã•ã›ã‚‹ã“ã¨",
                    "å…¨å›½ã®å¤§åã‚’çµ±åˆ¶ã™ã‚‹ã“ã¨"
                ],
                correct: 3,
                explanation: "ç¬¬1æ®µè½ã§ã€Œå…¨å›½ã®å¤§åã‚’çµ±åˆ¶ã™ã‚‹ãŸã‚ã«è¨­ã‘ãŸåˆ¶åº¦ã€ã¨æ˜è¨˜ã•ã‚Œã¦ã„ã¾ã™"
            },
            {
                passage: `åœ°çƒæ¸©æš–åŒ–ã¯ã€æ¸©å®¤åŠ¹æœã‚¬ã‚¹ã®å¢—åŠ ã«ã‚ˆã£ã¦åœ°çƒã®å¹³å‡æ°—æ¸©ãŒä¸Šæ˜‡ã™ã‚‹ç¾è±¡ã§ã™ã€‚ãã®ä¸»ãªåŸå› ã¯ã€åŒ–çŸ³ç‡ƒæ–™ã®ç‡ƒç„¼ã€æ£®æ—ä¼æ¡ã€å·¥æ¥­æ´»å‹•ãªã©ã®äººé–“æ´»å‹•ã«ã‚ã‚Šã¾ã™ã€‚\n\nã€€æ¸©æš–åŒ–ã®å½±éŸ¿ã¯æ·±åˆ»ã§ã™ã€‚æµ·é¢ä¸Šæ˜‡ã«ã‚ˆã‚Šå³¶å›½ãŒæ°´æ²¡ã®å±æ©Ÿã«ç›´é¢ã—ã€ç•°å¸¸æ°—è±¡ã®é »ç™ºã«ã‚ˆã‚Šè¾²æ¥­ã‚„ç”Ÿæ…‹ç³»ã«ç”šå¤§ãªè¢«å®³ãŒç”Ÿã˜ã¦ã„ã¾ã™ã€‚ã¾ãŸã€ç ‚æ¼ åŒ–ã®é€²è¡Œã‚„æ°´è³‡æºã®æ¯æ¸‡ã‚‚æ‡¸å¿µã•ã‚Œã¦ã„ã¾ã™ã€‚\n\nã€€ã“ã®å•é¡Œã‚’è§£æ±ºã™ã‚‹ã«ã¯ã€å›½éš›çš„ãªå”åŠ›ãŒä¸å¯æ¬ ã§ã™ã€‚å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¸ã®è»¢æ›ã€çœã‚¨ãƒãƒ«ã‚®ãƒ¼æŠ€è¡“ã®é–‹ç™ºã€æ£®æ—ä¿è­·ã®æ¨é€²ãªã©ã€ä¸–ç•Œå„å›½ãŒé€£æºã—ã¦å–ã‚Šçµ„ã‚€å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚ç§ãŸã¡ä¸€äººä¸€äººã‚‚ã€æ—¥å¸¸ç”Ÿæ´»ã§ç’°å¢ƒã«é…æ…®ã—ãŸè¡Œå‹•ã‚’å¿ƒãŒã‘ã‚‹ã“ã¨ãŒé‡è¦ã§ã™ã€‚`,
                question: "ç­†è€…ãŒåœ°çƒæ¸©æš–åŒ–å•é¡Œã®è§£æ±ºã«æœ€ã‚‚é‡è¦ã ã¨è€ƒãˆã¦ã„ã‚‹ã‚‚ã®ã¯ä½•ã§ã™ã‹ã€‚",
                options: [
                    "å†ç”Ÿå¯èƒ½ã‚¨ãƒãƒ«ã‚®ãƒ¼ã¸ã®è»¢æ›",
                    "çœã‚¨ãƒãƒ«ã‚®ãƒ¼æŠ€è¡“ã®é–‹ç™º",
                    "å€‹äººã®ç’°å¢ƒé…æ…®è¡Œå‹•",
                    "å›½éš›çš„ãªå”åŠ›"
                ],
                correct: 3,
                explanation: "ç¬¬3æ®µè½ã§ã€Œå›½éš›çš„ãªå”åŠ›ãŒä¸å¯æ¬ ã§ã™ã€ã¨æœ€åˆã«è¿°ã¹ã€ãã®é‡è¦æ€§ã‚’å¼·èª¿ã—ã¦ã„ã¾ã™"
            }
        ];

        let currentReadingProblem = 0;

        // èª­è§£å•é¡Œè¡¨ç¤º
        function showReadingProblem() {
            if (currentReadingProblem >= readingProblems.length) {
                alert('ğŸ† èª­è§£å•é¡Œå®Œäº†ï¼\nãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼');
                goHome();
                return;
            }

            const problem = readingProblems[currentReadingProblem];
            
            document.getElementById('readingNum').textContent = currentReadingProblem + 1;
            document.getElementById('passageContainer').textContent = problem.passage;
            document.getElementById('readingQuestionText').textContent = problem.question;
            
            const optionsHTML = problem.options.map((option, index) => 
                `<button class="option-btn" onclick="checkReadingAnswer(${index})">${index + 1}. ${option}</button>`
            ).join('');
            
            document.getElementById('readingOptionsContainer').innerHTML = optionsHTML;
            
            console.log(`ğŸ“– èª­è§£å•é¡Œ${currentReadingProblem + 1}è¡¨ç¤º`);
        }

        // èª­è§£å•é¡Œç­”ãˆåˆã‚ã›
        function checkReadingAnswer(selected) {
            const problem = readingProblems[currentReadingProblem];
            const buttons = document.querySelectorAll('#readingOptionsContainer .option-btn');
            const isCorrect = selected === problem.correct;
            
            if (isCorrect) {
                buttons[selected].classList.add('correct');
                score += 20;
                userData.correctToday++;
                showResultPopup(true, problem.explanation);
            } else {
                buttons[selected].classList.add('incorrect');
                buttons[problem.correct].classList.add('correct');
                showResultPopup(false, problem.explanation);
            }
            
            userData.questionsToday++;
            updateUI();
            
            setTimeout(() => {
                currentReadingProblem++;
                closeResultPopup();
                showReadingProblem();
            }, 3000);
        }

        // ç”»é¢åˆ‡ã‚Šæ›¿ãˆé–¢æ•°
        function showScreen(screenId) {
            console.log(`ğŸ”„ ç”»é¢åˆ‡ã‚Šæ›¿ãˆ: ${screenId}`);
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const screen = document.getElementById(screenId);
            if (screen) {
                screen.classList.add('active');
                console.log(`âœ… ${screenId} è¡¨ç¤ºå®Œäº†`);
            } else {
                console.error(`âŒ ${screenId} ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“`);
            }
        }

        // æ¼¢å­—ç·´ç¿’é–‹å§‹
        function startKanji() {
            console.log('ğŸ“ æ¼¢å­—ç·´ç¿’é–‹å§‹ï¼ˆã‚·ãƒ³ãƒ—ãƒ«ç‰ˆï¼‰');
            currentQuestion = 0;
            score = 0;
            showScreen('kanjiScreen');
            showKanjiQuestion();
        }

        // èª­è§£å•é¡Œé–‹å§‹ï¼ˆä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«ï¼‰
        function startReading() {
            console.log('ğŸ“– èª­è§£å•é¡Œé–‹å§‹');
            showScreen('readingScreen');
            showReadingProblem();
        }

        // ä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«å››å­—ç†Ÿèªãƒ»ã“ã¨ã‚ã–å•é¡Œ
        const vocabularyProblems = [
            {
                question: "ã€Œè‡¥è–ªå˜—èƒ†ã€ã®æ„å‘³ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã‚’é¸ã³ãªã•ã„ã€‚",
                options: [
                    "è‹¦åŠ´ã—ã¦å¾©è®ã®æ©Ÿä¼šã‚’å¾…ã¤ã“ã¨",
                    "è–ªã®ä¸Šã§å¯ã‚‹ã“ã¨",
                    "è‹¦ã„è–¬ã‚’é£²ã‚€ã“ã¨", 
                    "å›°é›£ãªçŠ¶æ³ã«è€ãˆã‚‹ã“ã¨"
                ],
                correct: 0,
                explanation: "è‡¥è–ªå˜—èƒ†ï¼ˆãŒã—ã‚“ã—ã‚‡ã†ãŸã‚“ï¼‰= è¾›ã„æ€ã„ã‚’ã—ã¦å°†æ¥ã®æˆåŠŸã‚’æœŸã™ã“ã¨"
            },
            {
                question: "ã€Œç”»ç«œç‚¹ç›ã€ã®æ„å‘³ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã‚’é¸ã³ãªã•ã„ã€‚",
                options: [
                    "çµµã‚’ä¸Šæ‰‹ã«æãã“ã¨",
                    "æœ€å¾Œã«å¤§åˆ‡ãªéƒ¨åˆ†ã‚’ä»•ä¸Šã’ã‚‹ã“ã¨",
                    "ç«œã®ã‚ˆã†ã«å¼·ããªã‚‹ã“ã¨",
                    "å®Œç’§ã‚’ç›®æŒ‡ã™ã“ã¨"
                ],
                correct: 1,
                explanation: "ç”»ç«œç‚¹ç›ï¼ˆãŒã‚Šã‚‡ã†ã¦ã‚“ã›ã„ï¼‰= ä»•ä¸Šã’ã®é‡è¦ãªéƒ¨åˆ†ã‚’åŠ ãˆã¦å®Œæˆã•ã›ã‚‹ã“ã¨"
            },
            {
                question: "ã€Œç ´å¤©è’ã€ã®æ­£ã—ã„æ„å‘³ã‚’é¸ã³ãªã•ã„ã€‚",
                options: [
                    "ã¨ã¦ã‚‚æ¿€ã—ã„ã“ã¨",
                    "å¤©æ°—ãŒè’ã‚Œã‚‹ã“ã¨",
                    "ä»Šã¾ã§èª°ã‚‚ã—ãªã‹ã£ãŸã“ã¨ã‚’ã™ã‚‹ã“ã¨",
                    "ç©ºãŒç ´ã‚Œã‚‹ã“ã¨"
                ],
                correct: 2,
                explanation: "ç ´å¤©è’ï¼ˆã¯ã¦ã‚“ã“ã†ï¼‰= ä»Šã¾ã§èª°ã‚‚ã—ãªã‹ã£ãŸã“ã¨ã‚’åˆã‚ã¦ã™ã‚‹ã“ã¨"
            },
            {
                question: "ã€Œå‘‰è¶ŠåŒèˆŸã€ã®æ„å‘³ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã‚’é¸ã³ãªã•ã„ã€‚",
                options: [
                    "åŒã˜èˆ¹ã«ä¹—ã‚‹ã“ã¨",
                    "å¤–å›½äººã¨ä¸€ç·’ã«æ—…è¡Œã™ã‚‹ã“ã¨",
                    "ä»²ã®æ‚ªã„è€…åŒå£«ãŒå”åŠ›ã™ã‚‹ã“ã¨",
                    "å¤ã„æ™‚ä»£ã®äº¤é€šæ‰‹æ®µ"
                ],
                correct: 2,
                explanation: "å‘‰è¶ŠåŒèˆŸï¼ˆã”ãˆã¤ã©ã†ã—ã‚…ã†ï¼‰= ä»²ã®æ‚ªã„è€…åŒå£«ãŒåŒã˜å¢ƒé‡ã«ç½®ã‹ã‚Œã€å”åŠ›ã›ã–ã‚‹ã‚’å¾—ãªã„ã“ã¨"
            },
            {
                question: "ã€Œé¶å£ç‰›å¾Œã€ã®æ„å‘³ã¨ã—ã¦æ­£ã—ã„ã‚‚ã®ã‚’é¸ã³ãªã•ã„ã€‚",
                options: [
                    "é¶ã®å£ã¨ç‰›ã®ã—ã£ã½",
                    "å¤§ããªçµ„ç¹”ã®æœ«ç«¯ã‚ˆã‚Šå°ã•ãªçµ„ç¹”ã®é•·",
                    "å‹•ç‰©ã®é †ç•ªã‚’è¡¨ã™ã“ã¨",
                    "é£Ÿã¹ç‰©ã®å¥½ã¿ã‚’è¡¨ã™ã“ã¨"
                ],
                correct: 1,
                explanation: "é¶å£ç‰›å¾Œï¼ˆã‘ã„ã“ã†ãã‚…ã†ã”ï¼‰= å¤§ããªé›†å›£ã®æœ«ç«¯ã«ã„ã‚‹ã‚ˆã‚Šã€å°ã•ãªé›†å›£ã§ã‚‚é•·ã«ãªã‚‹æ–¹ãŒã‚ˆã„"
            }
        ];

        let currentVocabProblem = 0;

        // èªå½™åŠ›å¼·åŒ–é–‹å§‹
        function startVocab() {
            console.log('ğŸ’¬ èªå½™åŠ›å¼·åŒ–é–‹å§‹');
            currentVocabProblem = 0;
            showScreen('vocabularyScreen');
            showVocabProblem();
        }

        // èªå½™å•é¡Œè¡¨ç¤º
        function showVocabProblem() {
            if (currentVocabProblem >= vocabularyProblems.length) {
                alert('ğŸ† å››å­—ç†Ÿèªãƒ»ã“ã¨ã‚ã–å®Œäº†ï¼\nãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼');
                goHome();
                return;
            }

            const problem = vocabularyProblems[currentVocabProblem];
            
            document.getElementById('vocabNum').textContent = currentVocabProblem + 1;
            document.getElementById('vocabQuestionText').textContent = problem.question;
            
            const optionsHTML = problem.options.map((option, index) => 
                `<button class="option-btn" onclick="checkVocabAnswer(${index})">${index + 1}. ${option}</button>`
            ).join('');
            
            document.getElementById('vocabOptionsContainer').innerHTML = optionsHTML;
            
            console.log(`ğŸ’¬ èªå½™å•é¡Œ${currentVocabProblem + 1}è¡¨ç¤º`);
        }

        // èªå½™å•é¡Œç­”ãˆåˆã‚ã›
        function checkVocabAnswer(selected) {
            const problem = vocabularyProblems[currentVocabProblem];
            const buttons = document.querySelectorAll('#vocabOptionsContainer .option-btn');
            const isCorrect = selected === problem.correct;
            
            if (isCorrect) {
                buttons[selected].classList.add('correct');
                score += 15;
                userData.correctToday++;
                showResultPopup(true, problem.explanation);
            } else {
                buttons[selected].classList.add('incorrect');
                buttons[problem.correct].classList.add('correct');
                showResultPopup(false, problem.explanation);
            }
            
            userData.questionsToday++;
            updateUI();
            
            setTimeout(() => {
                currentVocabProblem++;
                closeResultPopup();
                showVocabProblem();
            }, 3500);
        }

        // ä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«è¨˜è¿°å•é¡Œ
        const writingProblems = [
            {
                passage: `ç§‘å­¦æŠ€è¡“ã®ç™ºé”ã«ã‚ˆã‚Šã€ç§ãŸã¡ã®ç”Ÿæ´»ã¯ä¾¿åˆ©ã«ãªã‚Šã¾ã—ãŸã€‚ã‚¹ãƒãƒ¼ãƒˆãƒ•ã‚©ãƒ³ã‚„ã‚¤ãƒ³ã‚¿ãƒ¼ãƒãƒƒãƒˆã«ã‚ˆã‚Šã€ä¸–ç•Œä¸­ã®æƒ…å ±ã‚’ç¬æ™‚ã«å¾—ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚ã—ã‹ã—ã€ä¸€æ–¹ã§äººã¨äººã¨ã®ç›´æ¥çš„ãªã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãŒæ¸›å°‘ã—ã€ãƒ‡ã‚¸ã‚¿ãƒ«ä¾å­˜ã¨ã„ã†æ–°ãŸãªå•é¡Œã‚‚ç”Ÿã¾ã‚Œã¦ã„ã¾ã™ã€‚`,
                question: "ç§‘å­¦æŠ€è¡“ã®ç™ºé”ãŒã‚‚ãŸã‚‰ã—ãŸè‰¯ã„é¢ã¨å•é¡Œç‚¹ã«ã¤ã„ã¦ã€ã‚ãªãŸã®è€ƒãˆã‚’80å­—ä»¥å†…ã§è¿°ã¹ãªã•ã„ã€‚",
                maxChars: 80,
                keyWords: ["ä¾¿åˆ©", "æƒ…å ±", "ã‚³ãƒŸãƒ¥ãƒ‹ã‚±ãƒ¼ã‚·ãƒ§ãƒ³", "ä¾å­˜", "å•é¡Œ"],
                modelAnswer: "ç§‘å­¦æŠ€è¡“ã«ã‚ˆã‚Šæƒ…å ±åé›†ãŒä¾¿åˆ©ã«ãªã£ãŸãŒã€äººã¨ã®ç›´æ¥çš„ãªé–¢ã‚ã‚ŠãŒæ¸›ã‚Šã€ãƒ‡ã‚¸ã‚¿ãƒ«ä¾å­˜ãªã©ã®å•é¡Œã‚‚ç”Ÿã¾ã‚Œã¦ã„ã‚‹ã€‚"
            },
            {
                passage: `æ±Ÿæˆ¸æ™‚ä»£ã®å‚å‹¤äº¤ä»£åˆ¶åº¦ã«ã¤ã„ã¦å­¦ç¿’ã—ã¾ã—ãŸã€‚ã“ã®åˆ¶åº¦ã«ã‚ˆã‚Šã€å¤§åã®çµŒæ¸ˆåŠ›ã¯å‰ŠãŒã‚Œã¾ã—ãŸãŒã€ä¸€æ–¹ã§æ–‡åŒ–ã‚„æŠ€è¡“ã®äº¤æµãŒä¿ƒé€²ã•ã‚Œã€è¡—é“ã‚„å®¿å ´ç”ºãŒç™ºé”ã—ã¾ã—ãŸã€‚`,
                question: "å‚å‹¤äº¤ä»£åˆ¶åº¦ã®å½±éŸ¿ã«ã¤ã„ã¦ã€è‰¯ã„é¢ã¨æ‚ªã„é¢ã‚’æ•´ç†ã—ã¦70å­—ä»¥å†…ã§èª¬æ˜ã—ãªã•ã„ã€‚",
                maxChars: 70,
                keyWords: ["çµŒæ¸ˆåŠ›", "å‰ŠãŒã‚ŒãŸ", "æ–‡åŒ–äº¤æµ", "æŠ€è¡“", "è¡—é“", "ç™ºé”"],
                modelAnswer: "å¤§åã®çµŒæ¸ˆåŠ›ã‚’å‰Šãä¸€æ–¹ã§ã€æ–‡åŒ–ãƒ»æŠ€è¡“äº¤æµã‚’ä¿ƒé€²ã—ã€è¡—é“æ•´å‚™ã‚„å®¿å ´ç”ºç™ºé”ã‚’ã‚‚ãŸã‚‰ã—ãŸã€‚"
            }
        ];

        let currentWritingProblem = 0;

        // AIå•é¡Œç”Ÿæˆé–‹å§‹ï¼ˆè¨˜è¿°å•é¡Œã¨ã—ã¦å®Ÿè£…ï¼‰
        function startAI() {
            console.log('ğŸ¤– è¨˜è¿°å•é¡Œé–‹å§‹');
            currentWritingProblem = 0;
            showScreen('writingScreen');
            showWritingProblem();
        }

        // è¨˜è¿°å•é¡Œè¡¨ç¤º
        function showWritingProblem() {
            if (currentWritingProblem >= writingProblems.length) {
                alert('ğŸ† è¨˜è¿°å•é¡Œå®Œäº†ï¼\nãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼');
                goHome();
                return;
            }

            const problem = writingProblems[currentWritingProblem];
            
            document.getElementById('writingNum').textContent = currentWritingProblem + 1;
            document.getElementById('writingPassage').textContent = problem.passage;
            document.getElementById('writingQuestionText').textContent = problem.question;
            document.getElementById('maxChars').textContent = problem.maxChars;
            document.getElementById('writingAnswer').value = '';
            document.getElementById('charCount').textContent = '0';
            
            // æ–‡å­—æ•°ã‚«ã‚¦ãƒ³ãƒˆ
            const textarea = document.getElementById('writingAnswer');
            textarea.addEventListener('input', () => {
                const count = textarea.value.length;
                document.getElementById('charCount').textContent = count;
                
                if (count > problem.maxChars) {
                    textarea.style.borderColor = '#f44336';
                } else {
                    textarea.style.borderColor = '#90caf9';
                }
            });
            
            console.log(`âœï¸ è¨˜è¿°å•é¡Œ${currentWritingProblem + 1}è¡¨ç¤º`);
        }

        // è¨˜è¿°å•é¡Œæå‡º
        function submitWriting() {
            const problem = writingProblems[currentWritingProblem];
            const answer = document.getElementById('writingAnswer').value.trim();
            
            if (!answer) {
                alert('ç­”ãˆã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                return;
            }
            
            if (answer.length > problem.maxChars) {
                alert(`åˆ¶é™å­—æ•°ï¼ˆ${problem.maxChars}å­—ï¼‰ã‚’è¶…ãˆã¦ã„ã¾ã™ã€‚`);
                return;
            }
            
            // ç°¡æ˜“æ¡ç‚¹
            let score = 0;
            let feedback = [];
            
            // å­—æ•°ãƒã‚§ãƒƒã‚¯
            if (answer.length >= problem.maxChars * 0.8) {
                score += 3;
                feedback.push("âœ… é©åˆ‡ãªå­—æ•°ã§æ›¸ã‘ã¦ã„ã¾ã™");
            } else {
                feedback.push("âš ï¸ ã‚‚ã†å°‘ã—è©³ã—ãæ›¸ãã¾ã—ã‚‡ã†");
            }
            
            // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒã‚§ãƒƒã‚¯
            let keywordCount = 0;
            problem.keyWords.forEach(keyword => {
                if (answer.includes(keyword)) {
                    keywordCount++;
                }
            });
            
            if (keywordCount >= 3) {
                score += 4;
                feedback.push("âœ… é‡è¦ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒå«ã¾ã‚Œã¦ã„ã¾ã™");
            } else if (keywordCount >= 2) {
                score += 2;
                feedback.push("âš ï¸ ã‚‚ã†å°‘ã—ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ã‚’æ„è­˜ã—ã¾ã—ã‚‡ã†");
            } else {
                feedback.push("âŒ é‡è¦ãªã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãŒä¸è¶³ã—ã¦ã„ã¾ã™");
            }
            
            // æ–‡ç« æ§‹æˆãƒã‚§ãƒƒã‚¯
            if (answer.includes('ã€‚') && answer.split('ã€‚').length >= 2) {
                score += 2;
                feedback.push("âœ… æ–‡ç« ãŒé©åˆ‡ã«æ§‹æˆã•ã‚Œã¦ã„ã¾ã™");
            }
            
            const totalScore = Math.min(score, 10);
            
            alert(`ğŸ“ è¨˜è¿°å•é¡Œæ¡ç‚¹çµæœ

ç‚¹æ•°: ${totalScore}/10ç‚¹

${feedback.join('\n')}

å‚è€ƒè§£ç­”:
${problem.modelAnswer}`);
            
            userData.questionsToday++;
            if (totalScore >= 6) {
                userData.correctToday++;
            }
            updateUI();
            
            setTimeout(() => {
                currentWritingProblem++;
                showWritingProblem();
            }, 1000);
        }

        // ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹
        function goHome() {
            console.log('ğŸ  ãƒ›ãƒ¼ãƒ ç”»é¢ã«æˆ»ã‚‹');
            showScreen('mainScreen');
        }

        // æ¼¢å­—å•é¡Œè¡¨ç¤º
        function showKanjiQuestion() {
            if (currentQuestion >= kanjiProblems.length) {
                alert('ğŸ† æ¼¢å­—ç·´ç¿’å®Œäº†ï¼\nä¸­å­¦å—é¨“ãƒ¬ãƒ™ãƒ«ã®æ¼¢å­—ã‚’ã‚ˆãé ‘å¼µã‚Šã¾ã—ãŸï¼');
                goHome();
                return;
            }

            const problem = kanjiProblems[currentQuestion];
            
            document.getElementById('questionNum').textContent = currentQuestion + 1;
            document.getElementById('questionText').textContent = problem.question;
            
            const optionsHTML = problem.options.map((option, index) => 
                `<button class="option-btn" onclick="checkAnswer(${index})">${index + 1}. ${option}</button>`
            ).join('');
            
            document.getElementById('optionsContainer').innerHTML = optionsHTML;
            document.getElementById('hintText').style.display = 'none';
            
            console.log(`ğŸ“ å•é¡Œ${currentQuestion + 1}è¡¨ç¤º: ${problem.question}`);
        }

        // ç­”ãˆåˆã‚ã›
        function checkAnswer(selected) {
            const problem = kanjiProblems[currentQuestion];
            const buttons = document.querySelectorAll('.option-btn');
            const isCorrect = selected === problem.correct;
            
            console.log(`ğŸ” ç­”ãˆåˆã‚ã›: é¸æŠ=${selected}, æ­£è§£=${problem.correct}, çµæœ=${isCorrect ? 'æ­£è§£' : 'ä¸æ­£è§£'}`);
            
            if (isCorrect) {
                buttons[selected].classList.add('correct');
                score += 10;
                userData.correctToday++;
                showResultPopup(true, problem.explanation);
            } else {
                buttons[selected].classList.add('incorrect');
                buttons[problem.correct].classList.add('correct');
                showResultPopup(false, problem.explanation);
            }
            
            userData.questionsToday++;
            updateUI();
            
            setTimeout(() => {
                currentQuestion++;
                closeResultPopup();
                showKanjiQuestion();
            }, 2500);
        }

        // çµæœãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—è¡¨ç¤º
        function showResultPopup(isCorrect, explanation) {
            const popup = document.getElementById('resultPopup');
            const icon = document.getElementById('resultIcon');
            const message = document.getElementById('resultMessage');
            
            if (isCorrect) {
                icon.textContent = 'ğŸ‰';
                message.innerHTML = `<strong>æ­£è§£ï¼</strong><br>${explanation}`;
            } else {
                icon.textContent = 'ğŸ˜…';
                message.innerHTML = `<strong>ä¸æ­£è§£</strong><br>${explanation}`;
            }
            
            popup.classList.add('show');
        }

        // çµæœãƒãƒƒãƒ—ã‚¢ãƒƒãƒ—ã‚’é–‰ã˜ã‚‹
        function closeResultPopup() {
            document.getElementById('resultPopup').classList.remove('show');
        }

        // æ¬¡ã®å•é¡Œ
        function nextQuestion() {
            closeResultPopup();
            currentQuestion++;
            showKanjiQuestion();
        }

        // ãƒ’ãƒ³ãƒˆè¡¨ç¤º
        function showHint() {
            const problem = kanjiProblems[currentQuestion];
            const hintEl = document.getElementById('hintText');
            hintEl.textContent = problem.hint;
            hintEl.style.display = 'block';
        }

        // UIæ›´æ–°
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('totalPoints').textContent = userData.points;
            document.getElementById('userLevel').textContent = userData.level;
            document.getElementById('streakDays').textContent = userData.streak;
            
            const accuracy = userData.questionsToday > 0 
                ? Math.round((userData.correctToday / userData.questionsToday) * 100) 
                : 0;
            document.getElementById('accuracy').textContent = accuracy;
            
            document.getElementById('todayProgress').textContent = `${Math.min(userData.questionsToday * 3, 30)}/30åˆ†`;
        }

        // çµæœè¡¨ç¤º
        function showResult() {
            const accuracy = userData.questionsToday > 0 
                ? Math.round((userData.correctToday / userData.questionsToday) * 100) 
                : 0;
            
            alert(`ğŸ† æ¼¢å­—ç·´ç¿’å®Œäº†ï¼
                    
ã‚¹ã‚³ã‚¢: ${score}ç‚¹
æ­£ç­”ç‡: ${accuracy}%
                    
ãŠç–²ã‚Œã•ã¾ã§ã—ãŸï¼`);
            
            goHome();
        }

        // åˆæœŸåŒ–
        document.addEventListener('DOMContentLoaded', function() {
            console.log('âœ… ã‚·ãƒ³ãƒ—ãƒ«ç‰ˆã‚¢ãƒ—ãƒªèª­ã¿è¾¼ã¿å®Œäº†');
            document.getElementById('appStatus').textContent = 'æ­£å¸¸å‹•ä½œä¸­';
            updateUI();
            
            // 5ç§’å¾Œã«å‹•ä½œç¢ºèª
            setTimeout(() => {
                console.log('ğŸ” 5ç§’å¾Œå‹•ä½œç¢ºèª');
                const kanjiBtn = document.querySelector('.menu-btn');
                if (kanjiBtn) {
                    console.log('âœ… æ¼¢å­—ãƒœã‚¿ãƒ³è¦ç´ å­˜åœ¨ç¢ºèª');
                } else {
                    console.error('âŒ æ¼¢å­—ãƒœã‚¿ãƒ³è¦ç´ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
            }, 5000);
        });

        // ãƒ‡ãƒãƒƒã‚°ç”¨ï¼šå¼·åˆ¶çš„ã«ãƒœã‚¿ãƒ³ã‚’æœ‰åŠ¹åŒ–
        setTimeout(() => {
            const buttons = document.querySelectorAll('.menu-btn');
            buttons.forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    console.log(`ğŸ”˜ ãƒœã‚¿ãƒ³${index + 1}ãŒã‚¯ãƒªãƒƒã‚¯ã•ã‚Œã¾ã—ãŸ`);
                });
            });
            console.log('ğŸ”˜ ãƒœã‚¿ãƒ³ã‚¤ãƒ™ãƒ³ãƒˆãƒªã‚¹ãƒŠãƒ¼è¿½åŠ å®Œäº†');
        }, 2000);

    </script>
</body>
</html>