<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>合格への道 - 国語学習アプリ（シンプル版）</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, #e3f2fd 0%, #f3e5f5 100%);
            min-height: 100vh;
            color: #333;
            padding: 20px;
        }

        .container {
            max-width: 480px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #1976d2, #1565c0);
            color: white;
            border-radius: 15px;
        }

        .menu-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .menu-btn {
            background: linear-gradient(135deg, #bbdefb, #e3f2fd);
            border: 2px solid #90caf9;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            text-align: center;
            transition: all 0.3s ease;
            font-size: 16px;
            color: #1565c0;
        }

        .menu-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(25, 118, 210, 0.2);
        }

        .menu-icon {
            font-size: 36px;
            margin-bottom: 10px;
            display: block;
        }

        .screen {
            display: none;
        }

        .screen.active {
            display: block;
        }

        .practice-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e3f2fd;
        }

        .back-btn {
            background: #1976d2;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
        }

        .question-card {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
        }

        .question-text {
            font-size: 18px;
            margin-bottom: 20px;
            font-weight: bold;
        }

        .options {
            display: grid;
            gap: 10px;
        }

        .option-btn {
            background: #e3f2fd;
            border: 2px solid #90caf9;
            border-radius: 10px;
            padding: 15px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
        }

        .option-btn:hover {
            background: #bbdefb;
        }

        .option-btn.correct {
            background: #c8e6c9;
            border-color: #4caf50;
            color: #2e7d32;
        }

        .option-btn.incorrect {
            background: #ffcdd2;
            border-color: #f44336;
            color: #c62828;
        }

        .result-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 20px;
            text-align: center;
            z-index: 10000;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.3);
            display: none;
        }

        .result-popup.show {
            display: block;
            animation: popupShow 0.3s ease-out;
        }

        @keyframes popupShow {
            from { opacity: 0; transform: translate(-50%, -50%) scale(0.8); }
            to { opacity: 1; transform: translate(-50%, -50%) scale(1); }
        }

        .result-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }

        .debug-info {
            position: fixed;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 10000;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- メイン画面 -->
        <div id="mainScreen" class="screen active">
            <div class="header">
                <h1>📚 合格への道</h1>
                <p>中学受験国語学習アプリ</p>
                <div>Lv.<span id="userLevel">1</span> | <span id="streakDays">0</span>日連続</div>
            </div>

            <div class="menu-grid">
                <button class="menu-btn" onclick="startKanji()">
                    <span class="menu-icon">📝</span>
                    <div><strong>漢字練習</strong></div>
                    <div>基本漢字をマスター</div>
                </button>
                <button class="menu-btn" onclick="startReading()">
                    <span class="menu-icon">📖</span>
                    <div><strong>読解問題</strong></div>
                    <div>文章理解力を鍛える</div>
                </button>
                <button class="menu-btn" onclick="startVocab()">
                    <span class="menu-icon">💬</span>
                    <div><strong>語彙力強化</strong></div>
                    <div>ことわざ・慣用句</div>
                </button>
                <button class="menu-btn" onclick="startAI()">
                    <span class="menu-icon">🤖</span>
                    <div><strong>AI問題生成</strong></div>
                    <div>個人最適化問題</div>
                </button>
            </div>

            <div style="text-align: center; margin-top: 20px;">
                <div>📊 今日の進捗: <span id="todayProgress">0/30分</span></div>
                <div>⭐ ポイント: <span id="totalPoints">0</span>pt</div>
                <div>🎯 正答率: <span id="accuracy">0</span>%</div>
            </div>
        </div>

        <!-- 漢字練習画面 -->
        <div id="kanjiScreen" class="screen">
            <div class="practice-header">
                <button class="back-btn" onclick="goHome()">← 戻る</button>
                <h2>📝 漢字練習</h2>
                <div>スコア: <span id="score">0</span>点</div>
            </div>

            <div class="question-card">
                <div>問題 <span id="questionNum">1</span> / 10</div>
                <div class="question-text" id="questionText">
                    読み込み中...
                </div>
                <div class="options" id="optionsContainer">
                    <!-- 選択肢がここに表示される -->
                </div>
            </div>

            <div style="text-align: center;">
                <button onclick="showHint()" style="background: #ffc107; color: white; border: none; padding: 10px 20px; border-radius: 10px; cursor: pointer;">
                    💡 ヒント
                </button>
                <div id="hintText" style="margin-top: 10px; padding: 10px; background: #fff3cd; border-radius: 10px; display: none;"></div>
            </div>
        </div>

        <!-- 読解問題画面 -->
        <div id="readingScreen" class="screen">
            <div class="practice-header">
                <button class="back-btn" onclick="goHome()">← 戻る</button>
                <h2>📖 読解問題</h2>
                <div>問題 <span id="readingNum">1</span> / 3</div>
            </div>

            <div class="question-card">
                <div id="passageContainer" style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin-bottom: 15px; line-height: 1.8; font-size: 14px;">
                    <!-- 文章がここに表示される -->
                </div>
                <div class="question-text" id="readingQuestionText">
                    読み込み中...
                </div>
                <div class="options" id="readingOptionsContainer">
                    <!-- 選択肢がここに表示される -->
                </div>
            </div>
        </div>

        <!-- 語彙力強化画面 -->
        <div id="vocabularyScreen" class="screen">
            <div class="practice-header">
                <button class="back-btn" onclick="goHome()">← 戻る</button>
                <h2>💬 四字熟語・ことわざ</h2>
                <div>問題 <span id="vocabNum">1</span> / 5</div>
            </div>

            <div class="question-card">
                <div class="question-text" id="vocabQuestionText">
                    読み込み中...
                </div>
                <div class="options" id="vocabOptionsContainer">
                    <!-- 選択肢がここに表示される -->
                </div>
            </div>
        </div>

        <!-- 記述問題画面 -->
        <div id="writingScreen" class="screen">
            <div class="practice-header">
                <button class="back-btn" onclick="goHome()">← 戻る</button>
                <h2>✍️ 記述問題</h2>
                <div>問題 <span id="writingNum">1</span> / 2</div>
            </div>

            <div class="question-card">
                <div id="writingPassage" style="background: #f0f8ff; padding: 15px; border-radius: 10px; margin-bottom: 15px; line-height: 1.6; font-size: 14px;">
                    <!-- 文章がここに表示される -->
                </div>
                <div class="question-text" id="writingQuestionText">
                    読み込み中...
                </div>
                <div style="margin: 15px 0;">
                    <textarea id="writingAnswer" placeholder="ここに答えを書いてください" 
                              style="width: 100%; height: 120px; padding: 10px; border: 2px solid #90caf9; 
                                     border-radius: 10px; font-size: 16px; resize: vertical;"></textarea>
                    <div style="text-align: right; margin-top: 5px; font-size: 14px; color: #666;">
                        <span id="charCount">0</span> / <span id="maxChars">80</span> 字
                    </div>
                </div>
                <div style="text-align: center;">
                    <button onclick="submitWriting()" style="background: #1976d2; color: white; border: none; padding: 12px 25px; border-radius: 10px; cursor: pointer; font-size: 16px;">
                        解答提出
                    </button>
                </div>
            </div>
        </div>

        <!-- 結果ポップアップ -->
        <div id="resultPopup" class="result-popup">
            <div class="result-icon" id="resultIcon">🎉</div>
            <div id="resultMessage"></div>
            <button onclick="nextQuestion()" style="margin-top: 20px; padding: 10px 20px; background: #1976d2; color: white; border: none; border-radius: 10px; cursor: pointer;">
                次の問題
            </button>
        </div>
    </div>

    <!-- デバッグ情報 -->
    <div class="debug-info" id="debugInfo">
        アプリ状態: <span id="appStatus">読み込み中...</span>
    </div>

    <script>
        // シンプルで確実に動作するコード
        console.log('🚀 シンプル版アプリ開始');

        // 基本データ
        let currentQuestion = 0;
        let score = 0;
        let userData = {
            level: 1,
            points: 0,
            streak: 0,
            accuracy: 0,
            questionsToday: 0,
            correctToday: 0
        };

        // 中学受験レベル（偏差値50）漢字問題
        const kanjiProblems = [
            {
                question: "傍線部の漢字の読み方を答えなさい：彼の【卓越】した技術に驚いた。",
                options: ["たくえつ", "たくこし", "しょうえつ", "たくぜつ"],
                correct: 0,
                hint: "「卓」は「すぐれる」という意味です",
                explanation: "卓越（たくえつ）= 他よりも特に優れていること"
            },
            {
                question: "傍線部の漢字の読み方を答えなさい：【逸話】として語り継がれている。",
                options: ["いつわ", "いちわ", "いつだん", "いちだん"],
                correct: 0,
                hint: "世間にあまり知られていない興味深い話です",
                explanation: "逸話（いつわ）= 世間にあまり知られていない興味深い話"
            },
            {
                question: "傍線部の漢字の読み方を答えなさい：【謙遜】して自分の実力を隠した。",
                options: ["けんそん", "けんじょう", "きょうそん", "けんしょう"],
                correct: 0,
                hint: "「謙」は「へりくだる」という意味です",
                explanation: "謙遜（けんそん）= 控えめな態度をとること"
            },
            {
                question: "傍線部の漢字の読み方を答えなさい：【洞察】力を身につける。",
                options: ["とうさつ", "どうかつ", "とうかつ", "どうさつ"],
                correct: 3,
                hint: "物事の本質を見抜くことです",
                explanation: "洞察（どうさつ）= 物事の本質を見抜くこと"
            },
            {
                question: "傍線部の漢字の読み方を答えなさい：心の【葛藤】に苦しんだ。",
                options: ["かつとう", "かっとう", "くずとう", "かつどう"],
                correct: 1,
                hint: "相反する気持ちで悩むことです",
                explanation: "葛藤（かっとう）= 相反する気持ちで悩むこと"
            },
            {
                question: "傍線部の漢字の読み方を答えなさい：将来を【憂慮】している。",
                options: ["ゆうろ", "うりょ", "ゆりょ", "ゆうりょ"],
                correct: 3,
                hint: "心配して思い悩むことです",
                explanation: "憂慮（ゆうりょ）= 心配して思い悩むこと"
            },
            {
                question: "傍線部の漢字の読み方を答えなさい：目標に向かって【邁進】する。",
                options: ["まいしん", "まいじん", "ばいしん", "ばいじん"],
                correct: 0,
                hint: "目標に向かって勢いよく進むことです",
                explanation: "邁進（まいしん）= 目標に向かって勢いよく進むこと"
            },
            {
                question: "傍線部の漢字の読み方を答えなさい：他を【凌駕】する実力。",
                options: ["りんが", "りょうか", "りょうが", "りんか"],
                correct: 2,
                hint: "他を上回って優れることです",
                explanation: "凌駕（りょうが）= 他を上回って優れること"
            },
            {
                question: "傍線部の漢字の読み方を答えなさい：【顕著】な成果を上げた。",
                options: ["けんちょ", "けんちゃく", "あきらか", "めだつ"],
                correct: 0,
                hint: "はっきりと目立つことです",
                explanation: "顕著（けんちょ）= はっきりと目立つこと"
            },
            {
                question: "次の文の【　】に入る漢字を書きなさい：この計画は【スイコウ】が困難だ。",
                options: ["推考", "遂行", "水行", "垂行"],
                correct: 1,
                hint: "物事を最後まで行うことです",
                explanation: "遂行（すいこう）= 物事を最後まで行うこと"
            }
        ];

        // 中学受験レベル読解問題（偏差値50）
        const readingProblems = [
            {
                passage: `人工知能（AI）の発達により、私たちの生活は大きく変化しています。自動運転車、音声認識システム、画像診断技術など、AIは様々な分野で活用されています。\n\n　しかし、AIの普及には課題もあります。人間の仕事がAIに置き換えられる可能性や、AI技術の誤用による社会への悪影響などが懸念されています。また、AIの判断過程が不透明であることも問題視されています。\n\n　重要なのは、AIを単なる道具として捉え、人間がその使い方を適切に管理することです。AI技術の恩恵を最大限に活用しながら、人間らしさを失わない社会を築いていく必要があります。`,
                question: "筆者がAIについて最も重要だと考えていることは何ですか。",
                options: [
                    "AIの技術をさらに発達させること",
                    "AIの課題を完全に解決すること",
                    "人間がAIを適切に管理すること", 
                    "AIと人間の区別を明確にすること"
                ],
                correct: 2,
                explanation: "第3段落で「人間がその使い方を適切に管理することです」と述べられています"
            },
            {
                passage: `江戸時代の参勤交代制度は、徳川幕府が全国の大名を統制するために設けた制度でした。各藩の大名は、一年おきに江戸と領地を往復し、江戸に滞在中は幕府の監視下に置かれました。\n\n　この制度により、大名たちは多額の費用を交通費や江戸での生活費に費やすことになり、経済力を削がれました。また、大名の家族は江戸に人質として残され、謀反を起こすことが困難になりました。\n\n　一方で、参勤交代により各地の文化や技術の交流が促進され、街道の整備や宿場町の発達にもつながりました。江戸の人口増加や商業の発展にも大きく貢献したのです。`,
                question: "参勤交代制度の目的として正しいものはどれですか。",
                options: [
                    "文化や技術の交流を促進すること",
                    "街道の整備や宿場町を発達させること",
                    "江戸の人口を増加させること",
                    "全国の大名を統制すること"
                ],
                correct: 3,
                explanation: "第1段落で「全国の大名を統制するために設けた制度」と明記されています"
            },
            {
                passage: `地球温暖化は、温室効果ガスの増加によって地球の平均気温が上昇する現象です。その主な原因は、化石燃料の燃焼、森林伐採、工業活動などの人間活動にあります。\n\n　温暖化の影響は深刻です。海面上昇により島国が水没の危機に直面し、異常気象の頻発により農業や生態系に甚大な被害が生じています。また、砂漠化の進行や水資源の枯渇も懸念されています。\n\n　この問題を解決するには、国際的な協力が不可欠です。再生可能エネルギーへの転換、省エネルギー技術の開発、森林保護の推進など、世界各国が連携して取り組む必要があります。私たち一人一人も、日常生活で環境に配慮した行動を心がけることが重要です。`,
                question: "筆者が地球温暖化問題の解決に最も重要だと考えているものは何ですか。",
                options: [
                    "再生可能エネルギーへの転換",
                    "省エネルギー技術の開発",
                    "個人の環境配慮行動",
                    "国際的な協力"
                ],
                correct: 3,
                explanation: "第3段落で「国際的な協力が不可欠です」と最初に述べ、その重要性を強調しています"
            }
        ];

        let currentReadingProblem = 0;

        // 読解問題表示
        function showReadingProblem() {
            if (currentReadingProblem >= readingProblems.length) {
                alert('🏆 読解問題完了！\nお疲れさまでした！');
                goHome();
                return;
            }

            const problem = readingProblems[currentReadingProblem];
            
            document.getElementById('readingNum').textContent = currentReadingProblem + 1;
            document.getElementById('passageContainer').textContent = problem.passage;
            document.getElementById('readingQuestionText').textContent = problem.question;
            
            const optionsHTML = problem.options.map((option, index) => 
                `<button class="option-btn" onclick="checkReadingAnswer(${index})">${index + 1}. ${option}</button>`
            ).join('');
            
            document.getElementById('readingOptionsContainer').innerHTML = optionsHTML;
            
            console.log(`📖 読解問題${currentReadingProblem + 1}表示`);
        }

        // 読解問題答え合わせ
        function checkReadingAnswer(selected) {
            const problem = readingProblems[currentReadingProblem];
            const buttons = document.querySelectorAll('#readingOptionsContainer .option-btn');
            const isCorrect = selected === problem.correct;
            
            if (isCorrect) {
                buttons[selected].classList.add('correct');
                score += 20;
                userData.correctToday++;
                showResultPopup(true, problem.explanation);
            } else {
                buttons[selected].classList.add('incorrect');
                buttons[problem.correct].classList.add('correct');
                showResultPopup(false, problem.explanation);
            }
            
            userData.questionsToday++;
            updateUI();
            
            setTimeout(() => {
                currentReadingProblem++;
                closeResultPopup();
                showReadingProblem();
            }, 3000);
        }

        // 画面切り替え関数
        function showScreen(screenId) {
            console.log(`🔄 画面切り替え: ${screenId}`);
            document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
            const screen = document.getElementById(screenId);
            if (screen) {
                screen.classList.add('active');
                console.log(`✅ ${screenId} 表示完了`);
            } else {
                console.error(`❌ ${screenId} が見つかりません`);
            }
        }

        // 漢字練習開始
        function startKanji() {
            console.log('📝 漢字練習開始（シンプル版）');
            currentQuestion = 0;
            score = 0;
            showScreen('kanjiScreen');
            showKanjiQuestion();
        }

        // 読解問題開始（中学受験レベル）
        function startReading() {
            console.log('📖 読解問題開始');
            showScreen('readingScreen');
            showReadingProblem();
        }

        // 中学受験レベル四字熟語・ことわざ問題
        const vocabularyProblems = [
            {
                question: "「臥薪嘗胆」の意味として正しいものを選びなさい。",
                options: [
                    "苦労して復讐の機会を待つこと",
                    "薪の上で寝ること",
                    "苦い薬を飲むこと", 
                    "困難な状況に耐えること"
                ],
                correct: 0,
                explanation: "臥薪嘗胆（がしんしょうたん）= 辛い思いをして将来の成功を期すこと"
            },
            {
                question: "「画竜点睛」の意味として正しいものを選びなさい。",
                options: [
                    "絵を上手に描くこと",
                    "最後に大切な部分を仕上げること",
                    "竜のように強くなること",
                    "完璧を目指すこと"
                ],
                correct: 1,
                explanation: "画竜点睛（がりょうてんせい）= 仕上げの重要な部分を加えて完成させること"
            },
            {
                question: "「破天荒」の正しい意味を選びなさい。",
                options: [
                    "とても激しいこと",
                    "天気が荒れること",
                    "今まで誰もしなかったことをすること",
                    "空が破れること"
                ],
                correct: 2,
                explanation: "破天荒（はてんこう）= 今まで誰もしなかったことを初めてすること"
            },
            {
                question: "「呉越同舟」の意味として正しいものを選びなさい。",
                options: [
                    "同じ船に乗ること",
                    "外国人と一緒に旅行すること",
                    "仲の悪い者同士が協力すること",
                    "古い時代の交通手段"
                ],
                correct: 2,
                explanation: "呉越同舟（ごえつどうしゅう）= 仲の悪い者同士が同じ境遇に置かれ、協力せざるを得ないこと"
            },
            {
                question: "「鶏口牛後」の意味として正しいものを選びなさい。",
                options: [
                    "鶏の口と牛のしっぽ",
                    "大きな組織の末端より小さな組織の長",
                    "動物の順番を表すこと",
                    "食べ物の好みを表すこと"
                ],
                correct: 1,
                explanation: "鶏口牛後（けいこうぎゅうご）= 大きな集団の末端にいるより、小さな集団でも長になる方がよい"
            }
        ];

        let currentVocabProblem = 0;

        // 語彙力強化開始
        function startVocab() {
            console.log('💬 語彙力強化開始');
            currentVocabProblem = 0;
            showScreen('vocabularyScreen');
            showVocabProblem();
        }

        // 語彙問題表示
        function showVocabProblem() {
            if (currentVocabProblem >= vocabularyProblems.length) {
                alert('🏆 四字熟語・ことわざ完了！\nお疲れさまでした！');
                goHome();
                return;
            }

            const problem = vocabularyProblems[currentVocabProblem];
            
            document.getElementById('vocabNum').textContent = currentVocabProblem + 1;
            document.getElementById('vocabQuestionText').textContent = problem.question;
            
            const optionsHTML = problem.options.map((option, index) => 
                `<button class="option-btn" onclick="checkVocabAnswer(${index})">${index + 1}. ${option}</button>`
            ).join('');
            
            document.getElementById('vocabOptionsContainer').innerHTML = optionsHTML;
            
            console.log(`💬 語彙問題${currentVocabProblem + 1}表示`);
        }

        // 語彙問題答え合わせ
        function checkVocabAnswer(selected) {
            const problem = vocabularyProblems[currentVocabProblem];
            const buttons = document.querySelectorAll('#vocabOptionsContainer .option-btn');
            const isCorrect = selected === problem.correct;
            
            if (isCorrect) {
                buttons[selected].classList.add('correct');
                score += 15;
                userData.correctToday++;
                showResultPopup(true, problem.explanation);
            } else {
                buttons[selected].classList.add('incorrect');
                buttons[problem.correct].classList.add('correct');
                showResultPopup(false, problem.explanation);
            }
            
            userData.questionsToday++;
            updateUI();
            
            setTimeout(() => {
                currentVocabProblem++;
                closeResultPopup();
                showVocabProblem();
            }, 3500);
        }

        // 中学受験レベル記述問題
        const writingProblems = [
            {
                passage: `科学技術の発達により、私たちの生活は便利になりました。スマートフォンやインターネットにより、世界中の情報を瞬時に得ることができます。しかし、一方で人と人との直接的なコミュニケーションが減少し、デジタル依存という新たな問題も生まれています。`,
                question: "科学技術の発達がもたらした良い面と問題点について、あなたの考えを80字以内で述べなさい。",
                maxChars: 80,
                keyWords: ["便利", "情報", "コミュニケーション", "依存", "問題"],
                modelAnswer: "科学技術により情報収集が便利になったが、人との直接的な関わりが減り、デジタル依存などの問題も生まれている。"
            },
            {
                passage: `江戸時代の参勤交代制度について学習しました。この制度により、大名の経済力は削がれましたが、一方で文化や技術の交流が促進され、街道や宿場町が発達しました。`,
                question: "参勤交代制度の影響について、良い面と悪い面を整理して70字以内で説明しなさい。",
                maxChars: 70,
                keyWords: ["経済力", "削がれた", "文化交流", "技術", "街道", "発達"],
                modelAnswer: "大名の経済力を削ぐ一方で、文化・技術交流を促進し、街道整備や宿場町発達をもたらした。"
            }
        ];

        let currentWritingProblem = 0;

        // AI問題生成開始（記述問題として実装）
        function startAI() {
            console.log('🤖 記述問題開始');
            currentWritingProblem = 0;
            showScreen('writingScreen');
            showWritingProblem();
        }

        // 記述問題表示
        function showWritingProblem() {
            if (currentWritingProblem >= writingProblems.length) {
                alert('🏆 記述問題完了！\nお疲れさまでした！');
                goHome();
                return;
            }

            const problem = writingProblems[currentWritingProblem];
            
            document.getElementById('writingNum').textContent = currentWritingProblem + 1;
            document.getElementById('writingPassage').textContent = problem.passage;
            document.getElementById('writingQuestionText').textContent = problem.question;
            document.getElementById('maxChars').textContent = problem.maxChars;
            document.getElementById('writingAnswer').value = '';
            document.getElementById('charCount').textContent = '0';
            
            // 文字数カウント
            const textarea = document.getElementById('writingAnswer');
            textarea.addEventListener('input', () => {
                const count = textarea.value.length;
                document.getElementById('charCount').textContent = count;
                
                if (count > problem.maxChars) {
                    textarea.style.borderColor = '#f44336';
                } else {
                    textarea.style.borderColor = '#90caf9';
                }
            });
            
            console.log(`✍️ 記述問題${currentWritingProblem + 1}表示`);
        }

        // 記述問題提出
        function submitWriting() {
            const problem = writingProblems[currentWritingProblem];
            const answer = document.getElementById('writingAnswer').value.trim();
            
            if (!answer) {
                alert('答えを入力してください。');
                return;
            }
            
            if (answer.length > problem.maxChars) {
                alert(`制限字数（${problem.maxChars}字）を超えています。`);
                return;
            }
            
            // 簡易採点
            let score = 0;
            let feedback = [];
            
            // 字数チェック
            if (answer.length >= problem.maxChars * 0.8) {
                score += 3;
                feedback.push("✅ 適切な字数で書けています");
            } else {
                feedback.push("⚠️ もう少し詳しく書きましょう");
            }
            
            // キーワードチェック
            let keywordCount = 0;
            problem.keyWords.forEach(keyword => {
                if (answer.includes(keyword)) {
                    keywordCount++;
                }
            });
            
            if (keywordCount >= 3) {
                score += 4;
                feedback.push("✅ 重要なキーワードが含まれています");
            } else if (keywordCount >= 2) {
                score += 2;
                feedback.push("⚠️ もう少しキーワードを意識しましょう");
            } else {
                feedback.push("❌ 重要なキーワードが不足しています");
            }
            
            // 文章構成チェック
            if (answer.includes('。') && answer.split('。').length >= 2) {
                score += 2;
                feedback.push("✅ 文章が適切に構成されています");
            }
            
            const totalScore = Math.min(score, 10);
            
            alert(`📝 記述問題採点結果

点数: ${totalScore}/10点

${feedback.join('\n')}

参考解答:
${problem.modelAnswer}`);
            
            userData.questionsToday++;
            if (totalScore >= 6) {
                userData.correctToday++;
            }
            updateUI();
            
            setTimeout(() => {
                currentWritingProblem++;
                showWritingProblem();
            }, 1000);
        }

        // ホーム画面に戻る
        function goHome() {
            console.log('🏠 ホーム画面に戻る');
            showScreen('mainScreen');
        }

        // 漢字問題表示
        function showKanjiQuestion() {
            if (currentQuestion >= kanjiProblems.length) {
                alert('🏆 漢字練習完了！\n中学受験レベルの漢字をよく頑張りました！');
                goHome();
                return;
            }

            const problem = kanjiProblems[currentQuestion];
            
            document.getElementById('questionNum').textContent = currentQuestion + 1;
            document.getElementById('questionText').textContent = problem.question;
            
            const optionsHTML = problem.options.map((option, index) => 
                `<button class="option-btn" onclick="checkAnswer(${index})">${index + 1}. ${option}</button>`
            ).join('');
            
            document.getElementById('optionsContainer').innerHTML = optionsHTML;
            document.getElementById('hintText').style.display = 'none';
            
            console.log(`📝 問題${currentQuestion + 1}表示: ${problem.question}`);
        }

        // 答え合わせ
        function checkAnswer(selected) {
            const problem = kanjiProblems[currentQuestion];
            const buttons = document.querySelectorAll('.option-btn');
            const isCorrect = selected === problem.correct;
            
            console.log(`🔍 答え合わせ: 選択=${selected}, 正解=${problem.correct}, 結果=${isCorrect ? '正解' : '不正解'}`);
            
            if (isCorrect) {
                buttons[selected].classList.add('correct');
                score += 10;
                userData.correctToday++;
                showResultPopup(true, problem.explanation);
            } else {
                buttons[selected].classList.add('incorrect');
                buttons[problem.correct].classList.add('correct');
                showResultPopup(false, problem.explanation);
            }
            
            userData.questionsToday++;
            updateUI();
            
            setTimeout(() => {
                currentQuestion++;
                closeResultPopup();
                showKanjiQuestion();
            }, 2500);
        }

        // 結果ポップアップ表示
        function showResultPopup(isCorrect, explanation) {
            const popup = document.getElementById('resultPopup');
            const icon = document.getElementById('resultIcon');
            const message = document.getElementById('resultMessage');
            
            if (isCorrect) {
                icon.textContent = '🎉';
                message.innerHTML = `<strong>正解！</strong><br>${explanation}`;
            } else {
                icon.textContent = '😅';
                message.innerHTML = `<strong>不正解</strong><br>${explanation}`;
            }
            
            popup.classList.add('show');
        }

        // 結果ポップアップを閉じる
        function closeResultPopup() {
            document.getElementById('resultPopup').classList.remove('show');
        }

        // 次の問題
        function nextQuestion() {
            closeResultPopup();
            currentQuestion++;
            showKanjiQuestion();
        }

        // ヒント表示
        function showHint() {
            const problem = kanjiProblems[currentQuestion];
            const hintEl = document.getElementById('hintText');
            hintEl.textContent = problem.hint;
            hintEl.style.display = 'block';
        }

        // UI更新
        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('totalPoints').textContent = userData.points;
            document.getElementById('userLevel').textContent = userData.level;
            document.getElementById('streakDays').textContent = userData.streak;
            
            const accuracy = userData.questionsToday > 0 
                ? Math.round((userData.correctToday / userData.questionsToday) * 100) 
                : 0;
            document.getElementById('accuracy').textContent = accuracy;
            
            document.getElementById('todayProgress').textContent = `${Math.min(userData.questionsToday * 3, 30)}/30分`;
        }

        // 結果表示
        function showResult() {
            const accuracy = userData.questionsToday > 0 
                ? Math.round((userData.correctToday / userData.questionsToday) * 100) 
                : 0;
            
            alert(`🏆 漢字練習完了！
                    
スコア: ${score}点
正答率: ${accuracy}%
                    
お疲れさまでした！`);
            
            goHome();
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            console.log('✅ シンプル版アプリ読み込み完了');
            document.getElementById('appStatus').textContent = '正常動作中';
            updateUI();
            
            // 5秒後に動作確認
            setTimeout(() => {
                console.log('🔍 5秒後動作確認');
                const kanjiBtn = document.querySelector('.menu-btn');
                if (kanjiBtn) {
                    console.log('✅ 漢字ボタン要素存在確認');
                } else {
                    console.error('❌ 漢字ボタン要素が見つかりません');
                }
            }, 5000);
        });

        // デバッグ用：強制的にボタンを有効化
        setTimeout(() => {
            const buttons = document.querySelectorAll('.menu-btn');
            buttons.forEach((btn, index) => {
                btn.addEventListener('click', () => {
                    console.log(`🔘 ボタン${index + 1}がクリックされました`);
                });
            });
            console.log('🔘 ボタンイベントリスナー追加完了');
        }, 2000);

    </script>
</body>
</html>